<html>
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=0">
<title>
ååˆ†é’Ÿé­”æ³•ç»ƒä¹ </title>
<style>
body { max-width: 650px; margin: auto; width: 90%; margin-top: 10%; margin-bottom: 10%; color: #0B0E26; background: #FAFAFC; line-height: 2em; }
body { font-family: -apple-system,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Microsoft YaHei,Source Han Sans SC,Noto Sans CJK SC,WenQuanYi Micro Hei,sans-serif; }
h1 { font-size: 2.5em; color: #EF96AB; line-height: 1.5em; }
h2 { margin-top: 2em; line-height: 1.5em; }
blockquote { color: gray; margin: 0; padding: 1 1 1 20; border-left: 5px solid #EF96AB; }
code, pre { font-family: Consolas,Menlo,Monaco,source-code-pro,Courier New,monospace; background: #FCF6FC; border-radius: 3px; padding-inline: 0.3rem; }
pre { overflow-x: auto; padding: 10px; }
a { color: #02AEF1; text-decoration: none; }
@media (prefers-color-scheme: dark) { body { color: #D8D8D6; background: #0E0E10; } }
@media (prefers-color-scheme: dark) { pre, code { color: #D8D8D6; background: #0E0F1F; } }
.hljs-keyword { color: #F288AF; }
.hljs-comment { color: #929CA6; }
.hljs-string { color: #0594A6; }
.hljs-title { color: #4581D9 }
</style>
</head>
<body>
<p>
<a href="https://magic.huohuo.moe">ğŸ HomepageğŸ </a> | <a href="https://github.com/niltok/magic-in-ten-mins">â­Star me on GitHubâ­</a></p>
<h1 id="ååˆ†é’Ÿé­”æ³•ç»ƒä¹ ï¼šä¾èµ–æ³¨å…¥">ååˆ†é’Ÿé­”æ³•ç»ƒä¹ ï¼šä¾èµ–æ³¨å…¥</h1>
<h3 id="by-ã€Œç©ç«ã€">By ã€Œç©ç«ã€</h3>
<blockquote>
<p>å‰ç½®æŠ€èƒ½ï¼šJavaåŸºç¡€ï¼ŒMonadï¼Œä»£æ•°ä½œç”¨</p>
</blockquote>
<h2 id="æ¨¡å—ä¾èµ–">æ¨¡å—ä¾èµ–</h2>
<p>æœ‰æ—¶å€™æŸäº›ç±»éœ€è¦åœ¨è¢«è°ƒç”¨æ–¹æ³•çš„æ—¶å€™ä½¿ç”¨å…¶ä»–ç±»ï¼š</p>
<pre><code class="language-java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Human</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">please</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">new</span> Hand().rush();
    }
    &lt;T&gt; <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">pick</span><span class="hljs-params">(T thing)</span> </span>{
        <span class="hljs-keyword">new</span> Hand().hold(thing);
    }
}</code></pre>
<p>ä¸è¿‡åƒä¸Šé¢çš„ <code>hand</code> åœ¨æ¯æ¬¡è°ƒç”¨çš„æ—¶å€™éƒ½åˆ›å»ºä¸€ä¸ªå®ä¾‹å¯¹ GC å°±å¾ˆä¸å‹å¥½ï¼Œå®é™…ä¸Šå¦‚æœä¸æ˜¯ä¸€æ¬¡æ€§çš„ä¸œè¥¿å®Œå…¨å¯ä»¥å¤ç”¨ï¼š</p>
<pre><code class="language-java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Human</span> </span>{
    Hand hand = <span class="hljs-keyword">new</span> Hand();
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">please</span><span class="hljs-params">()</span> </span>{
        hand.rush();
    }
    &lt;T&gt; <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">pick</span><span class="hljs-params">(T thing)</span> </span>{
        hand.hold(thing);
    }
}</code></pre>
<p>è¿™æ ·å¤„ç† <code>Human</code> çš„ä¾èµ–å¯ä»¥å¢å¼ºæ‰©å±•æ€§ï¼Œæ¯”å¦‚æ¢ä¸€ä¸ª <code>Hand</code> å®ç°åªéœ€è¦æ”¹ä¸€ä¸ªåœ°æ–¹ã€‚</p>
<p>è€Œè¿™ä¸ª <code>Hand</code> åœ¨è¿™é‡Œå°±æ˜¯ <code>Human</code> çš„ä¸€ä¸ª<strong>ä¾èµ–</strong>ï¼Œä¹Ÿå°±æ˜¯è¯´ <code>Human</code> <strong>ä¾èµ–</strong> <code>Hand</code> ã€‚</p>
<h2 id="ä¾èµ–æ³¨å…¥">ä¾èµ–æ³¨å…¥</h2>
<blockquote>
<p>ä¾èµ–æ³¨å…¥å°±æ˜¯æˆ‘ä¾èµ–ä½ ï¼Œä½ æŠŠä½ æ³¨å…¥ç»™æˆ‘ã€‚</p>
<p>By åƒé‡Œå†°å°</p>
</blockquote>
<p>ä¸Šé¢çš„ä»£ç æœ‰ä¸ªé—®é¢˜ï¼Œå¦‚æœä¸¤ä¸ªäººçš„æ‰‹ä¾èµ–ä¸åŒçš„å®ç°è¯¥æ€ä¹ˆåŠï¼Ÿå¦‚æœä¸€ä¸ªäººçš„æ‰‹æ˜¯è‚‰åšçš„ä¸€ä¸ªäººæ˜¯æœºæ¢°æ‰‹è¯¥æ€ä¹ˆåŠï¼Ÿ</p>
<p>è¿™æ—¶å€™å°±åº”è¯¥è®©æ„é€  <code>Human</code> çš„ä»£ç æ¥é€‰æ‹©æ„é€ ä»€ä¹ˆæ ·çš„ <code>Hand</code> ç„¶åèµ‹å€¼ç»™å¯¹åº”çš„å±æ€§æˆ–è€…ç›´æ¥ä¼ ç»™æ„é€ å‡½æ•°ï¼š</p>
<pre><code class="language-java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Human</span> </span>{
    Hand hand;
    Human(Hand hand) {
        <span class="hljs-keyword">this</span>.hand = hand;
    }
}</code></pre>
<p>è¿™æ ·ä½¿ç”¨ <code>Human</code> çš„ä»£ç åœ¨æ„é€  <code>Human</code> çš„æ—¶å€™å°±éœ€è¦ä¼ å…¥å®ƒçš„ä¾èµ–ï¼Œä¹Ÿå°±æ˜¯å®Œæˆä¸€æ¬¡å¯¹ <code>Human</code> çš„<strong>ä¾èµ–æ³¨å…¥</strong>ï¼ˆDependency Injectionï¼‰ï¼Œä¾èµ–ä»ä½¿ç”¨ <code>Human</code> çš„ä»£ç è½¬ç§»åˆ°äº† <code>Human</code> ä¸­ã€‚</p>
<p>è¿™æ ·è®¾è®¡å°±å¯ä»¥åœ¨é€ äººçš„æ—¶å€™é€‰æ‹©äººæœ‰ä»€ä¹ˆæ ·çš„æ‰‹ï¼Œç”šè‡³è¿˜èƒ½è®©ä¸¤ä¸ªäººå…±ç”¨ä¸€ä¸ªæ‰‹ã€‚</p>
<h2 id="è‡ªåŠ¨æ³¨å…¥">è‡ªåŠ¨æ³¨å…¥</h2>
<p>æ¯æ¬¡åœ¨ä½¿ç”¨ <code>Human</code> çš„æ—¶å€™éƒ½è¦è‡ªå·±æ“ä¸€ä¸ª <code>Hand</code> å¡è¿›å»å®åœ¨æ˜¯å¤ªéº»çƒ¦ï¼Œå¾ˆå¤šæ—¶å€™åªéœ€è¦é»˜è®¤çš„ <code>Hand</code> å°±è¡Œäº†ã€‚è¿™æ—¶å€™å°±éœ€è¦å·¥å‚æ¨¡å¼æ¥è‡ªåŠ¨æ³¨å…¥ä¾èµ–ï¼š</p>
<pre><code class="language-java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HumanFactory</span> </span>{
    Hand hand;
    <span class="hljs-function">HumanFactory <span class="hljs-title">withHand</span><span class="hljs-params">(Hand hand)</span> </span>{
        <span class="hljs-keyword">this</span>.hand = hand;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    }
    <span class="hljs-function">Human <span class="hljs-title">build</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">if</span> (hand == <span class="hljs-keyword">null</span>) 
            hand = <span class="hljs-keyword">new</span> HandDefault();
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Human(hand);
    }
}</code></pre>
<p>è¿™ç§æ³¨å…¥ä¾èµ–çš„æ–¹æ³•å¯¹ä¸€å †ä¾èµ–çš„æ¨¡å—æ•ˆæœæ‹”ç¾¤ï¼Œåªéœ€è¦é…ç½®éƒ¨åˆ†ä¾èµ–å°±å¯ä»¥æ­£ç¡®ä½¿ç”¨ã€‚</p>
<h2 id="ä¾èµ–æ³¨å…¥æ¡†æ¶">ä¾èµ–æ³¨å…¥æ¡†æ¶</h2>
<p>å·¥å‚æ¨¡å¼æœ‰ä¸ªé—®é¢˜ï¼Œå½“äº§å‡ºç‰©éå¸¸éå¸¸å¤æ‚çš„æ—¶å€™ä»£ç é‡æå¤§ï¼Œä½†è¿™å®é™…ä¸Šéƒ½æ˜¯èƒ½è‡ªåŠ¨ç”Ÿæˆçš„é‡å¤ä»£ç ï¼Œäºæ˜¯äººä»¬å°±åœ¨è¿™ä¸€å±‚ä¸Šè¿›ä¸€æ­¥æŠ½è±¡ï¼Œåšå‡ºäº†ä¾èµ–æ³¨å…¥æ¡†æ¶æ¥è‡ªåŠ¨ç”Ÿæˆè£…é…å·¥å‚ä»£ç ã€‚</p>
<p>ä¾‹å¦‚åœ¨Springä¸­å¯ä»¥é€šè¿‡è¿™æ ·æ·»åŠ æ³¨è§£æ¥ç”Ÿæˆè‡ªåŠ¨ä¾èµ–æ³¨å…¥ä»£ç ï¼š</p>
<pre><code class="language-java"><span class="hljs-meta">@Component(&quot;Human&quot;)</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Human</span> </span>{
    <span class="hljs-meta">@Resource(name=&quot;handDefault&quot;)</span>
    Hand hand;
}</code></pre>
<p>è€Œè°ƒç”¨ <code>context.getBean(&quot;Human&quot;)</code> å°±å¯ä»¥å¾—åˆ°ä¸€ä¸ª <code>Human</code> çš„å®ä¾‹ã€‚</p>
<h2 id="è¯»å–å™¨å•å­">è¯»å–å™¨å•å­</h2>
<p>å¦‚æœä½ ç²¾é€šå‡½æ•°å¼ç¼–ç¨‹å°±ä¼šæƒ³åˆ°ä¸ºå•¥ <code>Hand</code> è¦æ”¾åœ¨å¯¹è±¡é‡Œé¢å‘¢ï¼Œä¿å­˜çŠ¶æ€å¤šä¸å¥½ã€‚äºæ˜¯ç¬¬ä¸€ä¸ªç¨‹åºå¯ä»¥æ”¹æˆï¼š</p>
<pre><code class="language-java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Human</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">please</span><span class="hljs-params">(Hand hand)</span> </span>{
        hand.rush();
    }
    &lt;T&gt; <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">pick</span><span class="hljs-params">(Hand hand, T thing)</span> </span>{
        hand.hold(thing);
    }
}</code></pre>
<p>ä¸è¿‡è¿™æ ·æ¯ä¸ªå‡½æ•°éƒ½è¦ä¼ ä¸€é <code>Hand</code> å°±æŒºéº»çƒ¦çš„ï¼Œè¿™æ—¶å€™å°±å¯ä»¥ä½¿ç”¨ <code>Reader Monad</code> æ¥æ”¹å†™è¿™ä¸¤ä¸ªæ–¹æ³•ï¼š</p>
<pre><code class="language-java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Human</span> </span>{
    <span class="hljs-function">Reader&lt;Hand, Hand&gt; <span class="hljs-title">please</span><span class="hljs-params">()</span> </span>{
        ReaderM&lt;Hand&gt; m = <span class="hljs-keyword">new</span> ReaderM&lt;&gt;();
        <span class="hljs-keyword">return</span> Reader.narrow(
            m.flatMap(m.ask,
            hand -&gt; {
                hand.rush();
                <span class="hljs-keyword">return</span> m.pure(hand);
            }));
    }
    &lt;T&gt; <span class="hljs-function">Reader&lt;Hand, Hand&gt; <span class="hljs-title">pick</span><span class="hljs-params">(T thing)</span> </span>{
        ReaderM&lt;Hand&gt; m = <span class="hljs-keyword">new</span> ReaderM&lt;&gt;();
        <span class="hljs-keyword">return</span> Reader.narrow(
            m.flatMap(m.ask,
            hand -&gt; {
                hand.hold(thing);
                <span class="hljs-keyword">return</span> m.pure(hand);
            }));
    }
}</code></pre>
<p>è¿™æ ·å°±å¯ä»¥è®©ä¸€ä¸ªç¯å¢ƒåœ¨å‡½æ•°ä¹‹é—´éšå¼ä¼ é€’ï¼Œæ¥è¾¾åˆ°ä¾èµ–æ³¨å…¥çš„ç›®çš„ã€‚</p>
<p>ä¸è¿‡â€¦â€¦è¿™ä¼¼ä¹çœ‹ä¸Šå»æ›´åŠ å¤æ‚äº†â€¦â€¦</p>
<p>æˆ‘åœ¨è¿™é‡Œåªæ˜¯æä¾›ä¸€ç§æ€è·¯ï¼Œåœ¨æŸäº›å¯¹ <code>Monad</code> æ”¯æŒè‰¯å¥½çš„è¯­è¨€ä¸­è¿™ç§æ€è·¯æ˜¯ä¸€ç§æ›´ç®€ä¾¿çš„åŠæ³•ã€‚</p>
<h2 id="ä»£æ•°ä½œç”¨">ä»£æ•°ä½œç”¨</h2>
<p>è®²åˆ° <code>Reader Monad</code> ï¼Œè¯»è¿‡ä»£æ•°ä½œç”¨é‚£æœŸçš„è¯»è€…å°±ä¼šæƒ³åˆ° <code>Reader Monad</code> å’Œä»£æ•°ä½œç”¨æ˜¯åŒæ„çš„ã€‚é‚£æ—¢ç„¶ <code>Reader Monad</code> èƒ½ç”¨æ¥æ³¨å…¥ä¾èµ–ï¼Œä»£æ•°ä½œç”¨ä¹Ÿå¯ä»¥ï¼š</p>
<pre><code class="language-java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Human</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">please</span><span class="hljs-params">(Runnable cont)</span> </span>{
        Eff.Perform(<span class="hljs-string">&quot;Hand&quot;</span>, hand -&gt; {
            ((Hand) hand).rush();
            cont.run();
        });
    }
    &lt;T&gt; <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">pick</span><span class="hljs-params">(T thing, Runnable cont)</span> </span>{
        Eff.Perform(<span class="hljs-string">&quot;Hand&quot;</span>, hand -&gt; {
            ((Hand) hand).hold(thing);
            cont.run();
        })
    }
}</code></pre>
<p>è¿™æ ·çœ‹ä¸Šå»å°±æ¯” <code>Reader Monad</code> çš„å†™æ³•æ¸…æ™°å¾ˆå¤šï¼Œè™½ç„¶å›è°ƒçš„å†™æ³•ä¹ŸæŒºåäººç±»çš„â€¦â€¦ä¸è¿‡åœ¨æ”¯æŒä»£æ•°ä½œç”¨çš„è¯­è¨€é‡Œé¢è¿™ç§å†™æ³•å°†æ˜¯å¼ºåŠ›çš„ä¾èµ–æ³¨å…¥å·¥å…·ã€‚</p>
</body>
</html>
