<!DOCTYPE html><html lang="zh-CN" prefix="og: https://ogp.me/ns#">
<head >
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title >
ååˆ†é’Ÿé­”æ³•ç»ƒä¹ </title>
<style >
body {
    max-width: 35em;
    margin: auto;
    width: 90%;
    margin-top: 10%;
    margin-bottom: 10%;
    color: #0B0E26;
    background: #FAFAFC;
    line-height: 2em;
    text-rendering: optimizeLegibility;
    text-align: justify;
}

html {
    scroll-behavior: smooth;
    font-size: calc(min(.35vw + 16px, 25px));
    font-family: -apple-system, BlinkMacSystemFont, Helvetica Neue, PingFang SC, Microsoft YaHei, Source Han Sans SC, Noto Sans CJK SC, WenQuanYi Micro Hei, sans-serif;
}

h1 {
    font-size: 2.5rem;
    color: #EF96AB;
    line-height: 1.5em;
}

h2 {
    margin-top: 2rem;
    line-height: 1.5em;
}

h1,
h2,
h3 {
    /* text-align: center; */
}

blockquote {
    color: gray;
    margin: 0;
    padding: 1px 0 1px 1.2em;
    border-left: .3em solid #EF96AB;
}

code,
pre {
    font-size: 0.9rem;
    line-height: 1.8em;
    font-family: "JetBrains Mono", "ç­‰è·æ›´çº±é»‘ä½“ SC", "Fira Code", Menlo, Monaco, source-code-pro, Courier New, Consolas, monospace;
    background: #FCF6FC;
    border-radius: 3px;
    padding-inline: 0.3em;
}

pre {
    overflow-x: auto;
    padding: 1em 1.5em;
}

pre>code {
    padding-inline: 0;
}

::-webkit-scrollbar,
.element::-webkit-scrollbar,
.element {
    /* opacity: 0.5; */
}

a {
    color: #02AEF1;
    text-decoration: none;
}

@media (prefers-color-scheme: dark) {
    body {
        color: #D8D8D6;
        background: #0E0E10;
    }
}

@media (prefers-color-scheme: dark) {

    pre,
    code {
        color: #D8D8D6;
        background: #0E0F1F;
    }
}

.hljs-keyword {
    color: #F288AF;
}

.hljs-comment {
    color: #929CA6;
}

.hljs-string {
    color: #0594A6;
}

.hljs-title {
    color: #4581D9;
}

.hljs-type,
.hljs-built_in {
    color: #fca311;
}</style>
</head>
<body >
<p >
<a href="https://magic.huohuo.moe">ğŸ HomepageğŸ </a> | <a href="https://github.com/niltok/magic-in-ten-mins">â­Star me on GitHubâ­</a></p>
<h1 id="ååˆ†é’Ÿé­”æ³•ç»ƒä¹ ï¼š-Î¼">ååˆ†é’Ÿé­”æ³•ç»ƒä¹ ï¼š Î¼</h1>
<h3 id="by-ã€Œç©ç«ã€">By ã€Œç©ç«ã€</h3>
<blockquote>
<p>å‰ç½®æŠ€èƒ½ï¼šJava åŸºç¡€ï¼Œæ„é€ æ¼”ç®—ï¼Œ Y ç»„åˆå­</p>
</blockquote>
<h2 id="y-ç»„åˆå­çš„ç±»å‹">Y ç»„åˆå­çš„ç±»å‹</h2>
<p>Y ç»„åˆå­åœ¨æ— ç±»å‹ Î» æ¼”ç®—ä¸­æ˜¯è¿™æ ·å®šä¹‰çš„</p>
<pre><code>Y <span class="hljs-operator">=</span> Î» f. (Î» <span class="hljs-keyword">x</span>. f (<span class="hljs-keyword">x</span> <span class="hljs-keyword">x</span>)) (Î» <span class="hljs-keyword">x</span>. f (<span class="hljs-keyword">x</span> <span class="hljs-keyword">x</span>))
</code></pre>
<p>ä½†æ˜¯å®ƒçš„ç±»å‹æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå®é™…ä¸Šæˆ‘ä»¬å¯ä»¥æ„é€ å¦‚ä¸‹å¼å­æ¥åˆ†æï¼š</p>
<pre><code><span class="hljs-keyword">Y</span> f = f (<span class="hljs-keyword">Y</span> f)
</code></pre>
<p>å‡è®¾ <code>f</code> çš„ç±»å‹ä¸º <code>A</code> ï¼Œ <code>Y</code> çš„ç±»å‹ä¸º <code>A â†’ B</code> ï¼Œé‚£ä¹ˆ <code>Y f</code> çš„ç±»å‹å°±æ˜¯ <code>B</code> ï¼Œæ‰€ä»¥ç­‰å¼å³è¾¹çš„ç±»å‹ä¹Ÿåº”è¯¥ä¸º <code>B</code> ï¼Œé‚£ä¹ˆ <code>f</code> çš„ç±»å‹å°±åº”å½“æ˜¯ <code>A = B â†’ B</code> ï¼Œè§£å¾— <code>Y</code> çš„ç±»å‹ä¸º <code>(B â†’ B) â†’ B</code> ã€‚è¿™å°±è§£å¾—äº† Y ç»„åˆå­çš„å®è§‚ä¸Šçš„ç±»å‹ <code>Ï€ T: *. (T â†’ T) â†’ T</code> ã€‚</p>
<p>ä¸è¿‡å¦‚æœæƒ³å®Œæ•´åœ°å†™å‡º Y ç»„åˆå­ä¸­æ¯ä¸ªå˜é‡çš„ç±»å‹å°±ä¼šé‡åˆ°å›°éš¾ï¼Œ <code>x</code> çš„ç±»å‹æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå¦‚æœå‡è®¾ <code>x</code> çš„ç±»å‹æ˜¯ <code>A â†’ B</code> é‚£ä¹ˆè€ƒè™‘åˆ°å­˜åœ¨ <code>x x</code> è¿™æ ·çš„ç»“æ„ï¼Œ <code>A</code> åº”è¯¥å°±æ˜¯ <code>A â†’ B</code> ï¼Œä½†è¿™æ ·åˆå›åˆ°äº†æœ€å¼€å§‹çš„é—®é¢˜ï¼Œå‡è®¾ <code>x</code> çš„ç±»å‹æ˜¯ <code>(A â†’ B) â†’ B</code> ã€‚æ˜¾ç„¶è¿™æ ·æœ€åå¹¶ä¸æ”¶æ•›ï¼Œ <code>x</code> çš„ç±»å‹æ²¡æœ‰è§£ã€‚</p>
<p>æ—¢ç„¶ Y ç»„åˆå­ä¸­æœ‰äº›å˜é‡çš„ç±»å‹æ— æ³•è§£å‡ºé‚£ä¹ˆå®é™…ä¸Šåœ¨ Lambda Cube ä¸­çš„å„ä¸ªç±»å‹ç³»ç»Ÿéƒ½æ˜¯æ— æ³•æ„é€  Y ç»„åˆå­çš„ï¼Œè¿™å°±æ„å‘³ç€è¿™äº›ç±»å‹ç³»ç»Ÿæ²¡æœ‰åŠæ³•é€’å½’ï¼Œè€Œé€šè¿‡è¿™äº›ç±»å‹ç³»ç»Ÿæ£€æŸ¥çš„ç¨‹åºæ˜¯ä¸€å®šä¼šåœæœºçš„ã€‚è€Œå®é™…ä¸Šåœæœºæ˜¯å¥½çš„ï¼Œå¦‚æœæƒ³è®©å¸¦ Î¼ ç»“æ„çš„ç¨‹åºä¿è¯åœæœºå°±éœ€è¦åšåœæœºæ£€æŸ¥ï¼Œå½“ç„¶åœæœºé—®é¢˜æ˜¯ä¸å¯åˆ¤å®šçš„æ‰€ä»¥åœæœºæ£€æŸ¥åªèƒ½é€šè¿‡ä¸€å®šèƒ½åœæœºçš„ç¨‹åºå­é›†ã€‚</p>
<h2 id="Î¼">Î¼</h2>
<p>æ‰€ä»¥å®é™…ä¸Šè™½ç„¶çœ‹ä¸Šå»ç±»ä¼¼ Y çš„ä¸åŠ¨ç‚¹ç»„åˆå­æ˜¯å­˜åœ¨çš„ä½†æ˜¯æ— æ³•ç»™å‡ºå…·ä½“å®ç°ï¼Œè¿™æ—¶å€™å°±éœ€è¦åœ¨æ„é€ æ¼”ç®—ä¸­å¼€ä¸ªæ´æ¥è·å¾—ä¸åŠ¨ç‚¹ç»„åˆå­ã€‚åœ¨è¡¨è¾¾å¼ä¸­å¢åŠ  <code>Î¼ x: A. e</code> çš„ç»“æ„ï¼Œç­‰ä»·äº <code>Y (Î» x: A. e)</code> ï¼Œæ³¨æ„ <code>Y</code> çš„ç±»å‹æ˜¯ <code>(A â†’ A) â†’ A</code>  ï¼Œè€Œå¯¹åº”çš„ <code>Î» x: A. e</code> çš„ç±»å‹æ˜¯ <code>A â†’ A</code> ï¼Œä¹Ÿå°±æ˜¯è¯´ <code>e</code> çš„ç±»å‹æ˜¯ <code>A</code> ã€‚è°ƒç”¨ <code>Î¼</code> çš„ <code>reduce</code> å¾—åˆ° <code>e[x â†’ Î¼ x: A. e]</code> ã€‚</p>
<pre><code class="language-java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Mu</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Expr</span> </span>{
    Val x;
    Expr e;
    
    <span class="hljs-function">Expr <span class="hljs-title">open</span><span class="hljs-params">()</span> </span>{ <span class="hljs-comment">// unfold</span>
        <span class="hljs-keyword">return</span> e.apply(x, <span class="hljs-keyword">this</span>);
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> Expr <span class="hljs-title">reduce</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> Expr <span class="hljs-title">fullReduce</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> Expr <span class="hljs-title">checkType</span><span class="hljs-params">(Env env)</span> <span class="hljs-keyword">throws</span> BadTypeException </span>{
        Pi pi = <span class="hljs-keyword">new</span> Pi(x, e.checkType(<span class="hljs-keyword">new</span> ConsEnv(x, env)));
        <span class="hljs-keyword">if</span> (pi.checkType(env) <span class="hljs-keyword">instanceof</span> Sort &amp;&amp;
                pi.e.fullReduce().equals(pi.x.t.fullReduce()))
            <span class="hljs-keyword">return</span> pi.e;
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> BadTypeException();
    }
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">equals</span><span class="hljs-params">(Object o)</span> </span>{
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span> == o) <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
        <span class="hljs-keyword">if</span> (o == <span class="hljs-keyword">null</span>) <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
        <span class="hljs-keyword">if</span> (getClass() != e.getClass()) 
            <span class="hljs-keyword">return</span> Objects.equals(open(), e);
        <span class="hljs-comment">//         ^^^^^^^^^^^^^^^^^^^^^^^^^</span>
        Mu mu = (Mu) o;
        <span class="hljs-keyword">return</span> Objects.equals(e.apply(x, mu.x), mu.e);
        <span class="hljs-comment">//                    ^^^^^^^^^^^^^^^^</span>
    }
}
</code></pre>
<p>æ³¨æ„åœ¨æ¯”è¾ƒçš„æ—¶å€™å¦‚æœç±»å‹ä¸ä¸€è‡´éœ€è¦å°è¯•å±•å¼€å†ç»§ç»­æ¯”è¾ƒï¼Œè€Œä¸”å¯¹äºå…¶ä»–æ‰€æœ‰çš„è¡¨è¾¾å¼å…ƒç´ åœ¨æ¯”è¾ƒæ—¶éƒ½éœ€è¦å¯¹ Î¼ ç‰¹æ®Šå¤„ç†ï¼Œè¿™é‡Œæ‹¿ <code>Fun</code> ä¸¾ä¸ªä¾‹å­ï¼š</p>
<pre><code class="language-java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Fun</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Expr</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">equals</span><span class="hljs-params">(Object o)</span> </span>{
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span> == o) <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
        <span class="hljs-keyword">if</span> (o == <span class="hljs-keyword">null</span>) <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
        <span class="hljs-comment">// Or:                      equals(((Mu) o).open())</span>
        <span class="hljs-keyword">if</span> (o <span class="hljs-keyword">instanceof</span> Mu) <span class="hljs-keyword">return</span> o.equals(<span class="hljs-keyword">this</span>);
        <span class="hljs-comment">//  ^^^^^^^^^^^^^^^         ^^^^^^^^^^^^^^</span>
        <span class="hljs-keyword">if</span> (getClass() != o.getClass()) <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
        Fun fun = (Fun) o;
        <span class="hljs-keyword">return</span> Objects.equals(e, fun.e.apply(fun.x, x));
    }
}
</code></pre>
<p>åœ¨ <code>App</code> ä¸­ç¢°åˆ° Î¼ ä¹Ÿè¦å±•å¼€ä¸€ä¸‹ï¼š</p>
<pre><code class="language-java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">App</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Expr</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">public</span> Expr <span class="hljs-title">reduce</span><span class="hljs-params">()</span> </span>{
        Expr fr = f.reduce();
        <span class="hljs-keyword">if</span> (fr <span class="hljs-keyword">instanceof</span> Mu) fr = ((Mu) fr).open();
        <span class="hljs-comment">//  ^^^^^^^^^^^^^^^^  ^^^^^^^^^^^^^^^^^^^^^</span>
        <span class="hljs-keyword">if</span> (fr <span class="hljs-keyword">instanceof</span> Fun) {
            Fun fun = (Fun) fr;
            <span class="hljs-keyword">return</span> fun.e.apply(fun.x, x).reduce();
        }
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> App(fr.reduce(), x.reduce());
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> Expr <span class="hljs-title">fullReduce</span><span class="hljs-params">()</span> </span>{
        Expr fr = f.reduce();
        <span class="hljs-keyword">if</span> (fr <span class="hljs-keyword">instanceof</span> Mu) fr = ((Mu) fr).open();
        <span class="hljs-comment">//  ^^^^^^^^^^^^^^^^  ^^^^^^^^^^^^^^^^^^^^^</span>
        <span class="hljs-keyword">if</span> (fr <span class="hljs-keyword">instanceof</span> Fun) {
            Fun fun = (Fun) fr;
            <span class="hljs-keyword">return</span> fun.e.apply(fun.x, x).fullReduce();
        }
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> App(fr.fullReduce(), x.fullReduce());
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> Expr <span class="hljs-title">checkType</span><span class="hljs-params">(Env env)</span> <span class="hljs-keyword">throws</span> BadTypeException </span>{
        Expr tf = f.checkType(env).fullReduce();
        <span class="hljs-keyword">if</span> (tf <span class="hljs-keyword">instanceof</span> Mu) tf = ((Mu) tf).open();
        <span class="hljs-comment">//  ^^^^^^^^^^^^^^^^  ^^^^^^^^^^^^^^^^^^^^^</span>
        <span class="hljs-keyword">if</span> (tf <span class="hljs-keyword">instanceof</span> Pi) {
            Pi pi = (Pi) tf;
            <span class="hljs-keyword">if</span> (x.checkType(env).fullReduce().equals(pi.x.checkType(env).fullReduce()))
                <span class="hljs-keyword">return</span> pi.e.apply(pi.x, x);
        }
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> BadTypeException();
    }
}
</code></pre>
<p>Î¼ åªåœ¨ä½¿ç”¨çš„æ—¶å€™æ‰ä¼šå±•å¼€ä¸€æ¬¡ï¼Œè¿™æ˜¯ä¸ºäº†é˜²æ­¢å‡ºç°æ±‚å€¼æ—¶æ— é™é€’å½’çš„æƒ…å†µã€‚</p>
<blockquote>
<p>å®é™…ä¸Š Î¼ è¿™ä¸ªä¸œè¥¿åªæ˜¯ç”¨æ¥å¤„ç†ç±»å‹çš„ï¼Œä½†æ˜¯ CoC é‡Œé¢ä¸åŒºåˆ†ç±»å‹å’Œé¡¹æ‰€ä»¥è¿™é‡Œä¹Ÿç”¨äºé¡¹çš„é€’å½’äº†ã€‚</p>
</blockquote>
</body>
</html>
