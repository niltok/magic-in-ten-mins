<!DOCTYPE html><html lang="zh-CN" prefix="og: https://ogp.me/ns#">
<head >
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title >
ååˆ†é’Ÿé­”æ³•ç»ƒä¹ </title>
<style >
@font-face {
    font-family: "subset body font";
    src: url("body.woff2") format("woff2");
}

@font-face {
    font-family: "subset code font";
    src: url("code.woff2") format("woff2");
}

@font-face {
    font-family: "subset emoji font";
    src: url("emoji.woff2") format("woff2");
}

body {
    max-width: 35em;
    margin: auto;
    width: 90%;
    margin-top: 10%;
    margin-bottom: 10%;
    color: #0B0E26;
    background: #FAFAFC;
    line-height: 1.75em;
    text-rendering: optimizeLegibility;
    text-align: justify;
}

html {
    scroll-behavior: smooth;
    font-size: calc(min(.35vw + 16px, 25px));
    font-family: "subset body font", "Source Han Serif SC", "Noto Serif SC", "Songti SC", SimSun, "AR PL Sungti", "subset emoji font", serif;
}

h1 {
    font-size: 2.5rem;
    color: #EF96AB;
    line-height: 1.5em;
}

h2 {
    margin-top: 2rem;
    line-height: 1.5em;
}

h1,
h2,
h3 {
    /* text-align: center; */
}

blockquote {
    color: gray;
    margin: 0;
    padding: 1px 0 1px 1.2em;
    border-left: .3em solid #EF96AB;
}

code,
pre {
    font-size: 0.9rem;
    line-height: 1.8em;
    font-family: "subset code font", "ç­‰è·æ›´çº±é»‘ä½“ SC", "JetBrains Mono", "Fira Code", Menlo, Monaco, source-code-pro, Courier New, Consolas, "subset emoji font", monospace;
    background: #FCF6FC;
    border-radius: 3px;
    padding-inline: 0.3em;
}

pre {
    overflow-x: auto;
    padding: 1em 1.5em;
}

pre>code {
    padding-inline: 0;
}

::-webkit-scrollbar,
.element::-webkit-scrollbar,
.element {
    /* opacity: 0.5; */
}

a {
    color: #02AEF1;
    text-decoration: none;
}

@media (prefers-color-scheme: dark) {
    body {
        color: #D8D8D6;
        background: #0E0E10;
    }
}

@media (prefers-color-scheme: dark) {

    pre,
    code {
        color: #D8D8D6;
        background: #0E0F1F;
    }
}

.hljs-keyword {
    color: #F288AF;
}

.hljs-comment {
    color: #929CA6;
}

.hljs-string {
    color: #0594A6;
}

.hljs-title {
    color: #4581D9;
}

.hljs-type,
.hljs-built_in {
    color: #fca311;
}</style>
</head>
<body >
<p >
<a href="https://magic.huohuo.moe">ğŸ HomepageğŸ </a> | <a href="https://github.com/niltok/magic-in-ten-mins">â­Star me on GitHubâ­</a></p>
<h1 id="ååˆ†é’Ÿé­”æ³•ç»ƒä¹ ï¼šä»£æ•°ä½œç”¨">ååˆ†é’Ÿé­”æ³•ç»ƒä¹ ï¼šä»£æ•°ä½œç”¨</h1>
<h3 id="by-ã€Œç©ç«ã€">By ã€Œç©ç«ã€</h3>
<blockquote>
<p>å‰ç½®æŠ€èƒ½ï¼šJavaåŸºç¡€ï¼Œç»­å»¶</p>
</blockquote>
<h2 id="å¯æ¢å¤å¼‚å¸¸">å¯æ¢å¤å¼‚å¸¸</h2>
<p>æœ‰æ—¶å€™æˆ‘ä»¬å¸Œæœ›åœ¨å¼‚å¸¸æŠ›å‡ºåç»è¿‡ä¿å­˜å¼‚å¸¸ä¿¡æ¯å†è·³å›åŸæ¥çš„åœ°æ–¹ç»§ç»­æ‰§è¡Œã€‚</p>
<p>æ˜¾ç„¶Javaé»˜è®¤å¼‚å¸¸å¤„ç†æ— æ³•ç›´æ¥å®ç°è¿™æ ·çš„éœ€æ±‚ï¼Œå› ä¸ºåœ¨å¼‚å¸¸æŠ›å‡ºæ—¶æ•´ä¸ªè°ƒç”¨æ ˆçš„ä¿¡æ¯å…¨éƒ¨è¢«æ¸…é™¤äº†ã€‚</p>
<p>ä½†å¦‚æœæˆ‘ä»¬æœ‰äº†å¼‚å¸¸æŠ›å‡ºæ—¶çš„ç»­å»¶é‚£ä¹ˆå¯ä»¥åŒæ—¶æŠ›å‡ºï¼Œåœ¨ <code>catch</code> å—ä¸­è°ƒç”¨è¿™ä¸ªç»­å»¶å°±èƒ½æ¢å¤ä¹‹å‰çš„æ‰§è¡ŒçŠ¶æ€ã€‚</p>
<p>ä¸‹é¢æ˜¯å®ç°å¯æ¢å¤å¼‚å¸¸çš„ <code>try-catch</code> ï¼š</p>
<pre><code class="language-java">Stack&lt;BiConsumer&lt;Exception, Runnable&gt;&gt; cs = <span class="hljs-keyword">new</span> Stack&lt;&gt;();

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Try</span><span class="hljs-params">(Consumer&lt;Runnable&gt; body,
         TriConsumer&lt;Exception, Runnable, Runnable&gt; handler,
         Runnable cont)</span> </span>{
    cs.push((e, c) -&gt; handler.accept(e, cont, c));
    body.accept(cont);
    cs.pop();
}

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Throw</span><span class="hljs-params">(Exception e, Runnable cont)</span> </span>{
    cs.peek().accept(e, cont);
}
</code></pre>
<p>ç„¶åå°±å¯ä»¥åƒä¸‹é¢è¿™æ ·ä½¿ç”¨ï¼š</p>
<pre><code class="language-java"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">test</span><span class="hljs-params">(<span class="hljs-keyword">int</span> t)</span> </span>{
    Try(
    cont -&gt; {
        System.out.println(<span class="hljs-string">&quot;try&quot;</span>);
        <span class="hljs-keyword">if</span> (t == <span class="hljs-number">0</span>)
            Throw(<span class="hljs-keyword">new</span> ArithmeticException(), () -&gt; {
            System.out.println(<span class="hljs-string">&quot;resumed&quot;</span>);
            cont.run(); });
        <span class="hljs-keyword">else</span> {
            System.out.println(<span class="hljs-number">100</span> / t);
            cont.run();
        }
    },
    (e, cont, resume) -&gt; {
        System.out.println(<span class="hljs-string">&quot;catch&quot;</span>);
        resume.run();
    },
    () -&gt; System.out.println(<span class="hljs-string">&quot;final&quot;</span>));
}
</code></pre>
<p>è€Œè°ƒç”¨ <code>test(0)</code> å°±ä¼šå¾—åˆ°ï¼š</p>
<pre><code><span class="hljs-keyword">try</span>
<span class="hljs-keyword">catch</span>
resumed
<span class="hljs-keyword">final</span>
</code></pre>
<h2 id="ä»£æ•°ä½œç”¨">ä»£æ•°ä½œç”¨</h2>
<p>å¦‚æœè¯´åœ¨åˆšåˆšå¼‚å¸¸æ¢å¤çš„åŸºç¡€ä¸Šå¸Œæœ›åœ¨æ¢å¤æ—¶ä¿®è¡¥ä¹‹å‰çš„å¼‚å¸¸é”™è¯¯å°±éœ€è¦æŠŠä¹‹å‰çš„ <code>resume</code> å‡½æ•°åŠ ä¸Šå‚æ•°ï¼Œè¿™æ ·ä¿®æ”¹ä»¥åå®ƒå°±æˆäº†ä»£æ•°ä½œç”¨ï¼ˆAlgebaic Effectï¼‰çš„åŸºç¡€å·¥å…·ï¼š</p>
<pre><code class="language-java">Stack&lt;BiConsumer&lt;Object, Consumer&lt;Object&gt;&gt;&gt; cs = <span class="hljs-keyword">new</span> Stack&lt;&gt;();

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Try</span><span class="hljs-params">(Consumer&lt;Runnable&gt; body,
         TriConsumer&lt;Object, Runnable, Consumer&lt;Object&gt;&gt; handler,
         Runnable cont)</span> </span>{
    cs.push((e, c) -&gt; handler.accept(e, cont, c));
    body.accept(cont);
    cs.pop();
}

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Perform</span><span class="hljs-params">(Object e, Consumer&lt;Object&gt; cont)</span> </span>{
    cs.peek().accept(e, cont);
}
</code></pre>
<p>ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š</p>
<pre><code class="language-java"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">test</span><span class="hljs-params">(<span class="hljs-keyword">int</span> t)</span> </span>{
    Try(
    cont -&gt; {
        System.out.println(<span class="hljs-string">&quot;try&quot;</span>);
        <span class="hljs-keyword">if</span> (t == <span class="hljs-number">0</span>)
            Perform(<span class="hljs-keyword">new</span> ArithmeticException(), v -&gt; {
            System.out.println(<span class="hljs-string">&quot;resumed&quot;</span>);
            System.out.println(<span class="hljs-number">100</span> / (Integer) v);
            cont.run(); });
        <span class="hljs-keyword">else</span> {
            System.out.println(<span class="hljs-number">100</span> / t);
            cont.run();
        }
    },
    (e, cont, resume) -&gt; {
        System.out.println(<span class="hljs-string">&quot;catch&quot;</span>);
        resume.accept(<span class="hljs-number">1</span>);
    },
    () -&gt; System.out.println(<span class="hljs-string">&quot;final&quot;</span>));
}
</code></pre>
<p>è€Œè¿™ä¸ªä¸œè¥¿èƒ½å®ç°ä¸åªæ˜¯å¼‚å¸¸çš„åŠŸèƒ½ï¼Œä»æŸç§ç¨‹åº¦ä¸Šæ¥è¯´å®ƒèƒ½è·¨è¶Šå‡½æ•°å‘ç”Ÿä½œç”¨ï¼ˆPerform Effectï¼‰ã€‚</p>
<p>æ¯”å¦‚è¯´ç°åœ¨æœ‰ä¸ªå‡½æ•°è¦è®°å½•æ—¥å¿—ï¼Œä½†æ˜¯å®ƒå¹¶ä¸å…³å¿ƒå¦‚ä½•è®°å½•æ—¥å¿—ï¼Œè¾“å‡ºåˆ°æ ‡å‡†æµè¿˜æ˜¯å†™å…¥åˆ°æ–‡ä»¶æˆ–æ˜¯ä¸Šä¼ åˆ°æ•°æ®åº“ã€‚è¿™æ—¶å€™å®ƒå°±å¯ä»¥è°ƒç”¨</p>
<pre><code class="language-java">Perform(<span class="hljs-keyword">new</span> LogIt(INFO, <span class="hljs-string">&quot;test&quot;</span>), ...);
</code></pre>
<p>æ¥å‘ç”Ÿï¼ˆPerformï¼‰ä¸€ä¸ªè®°å½•æ—¥å¿—çš„ä½œç”¨ï¼ˆEffectï¼‰ç„¶åå†å›åˆ°ä¹‹å‰è°ƒç”¨çš„ä½ç½®ç»§ç»­æ‰§è¡Œï¼Œè€Œå…·ä½“è¿™ä¸ªä½œç”¨äº§ç”Ÿäº†ä»€ä¹ˆæ•ˆæœå°±ç”±è°ƒç”¨è¿™ä¸ªå‡½æ•°çš„äººå®ç°çš„ <code>try</code> ä¸­çš„ <code>handler</code> å†³å®šã€‚è¿™æ ·å‘ç”Ÿä½œç”¨å’Œæ‰§è¡Œä½œç”¨ï¼ˆHandle Effectï¼‰å°±è§£è€¦äº†ã€‚</p>
<p>è¿›ä¸€æ­¥è®²ï¼Œå‘ç”Ÿä½œç”¨å’Œæ‰§è¡Œä½œç”¨æ˜¯å¯ç»„åˆçš„ã€‚å¯¹äºéœ€è¦å‘ç”Ÿè®°å½•æ—¥å¿—çš„ä½œç”¨ï¼Œå¯ä»¥é¢„å…ˆå†™ä¸€ä¸ªè¾“å‡ºåˆ°æ ‡å‡†æµçš„çš„æ‰§è¡Œå™¨ï¼ˆHandlerï¼‰ä¸€ä¸ªè¾“å‡ºåˆ°æ–‡ä»¶çš„æ‰§è¡Œå™¨ç„¶ååœ¨è°ƒç”¨å‡½æ•°çš„æ—¶å€™æŒ‰éœ€ç»„åˆã€‚è¿™ä¹Ÿå°±æ˜¯å®ƒæ˜¯ä»£æ•°çš„ï¼ˆAlgebiacï¼‰çš„åŸå› ã€‚</p>
<p>ç»†å¿ƒçš„è¯»è€…è¿˜ä¼šå‘ç°è¿™ä¸ªä¸œè¥¿è¿˜èƒ½è·¨å‡½æ•°ä¼ é€’æ•°æ®ï¼Œåœ¨éœ€è¦æŸä¸ªé‡çš„æ—¶å€™è°ƒç”¨</p>
<pre><code class="language-java">Perform(<span class="hljs-keyword">new</span> Ask(<span class="hljs-string">&quot;config&quot;</span>), ...);
</code></pre>
<p>å°±å¯ä»¥è·å¾—è¿™ä¸ªé‡è€Œä¸ç”¨å…³å¿ƒè¿™ä¸ªé‡æ˜¯æ€ä¹ˆæ¥çš„ï¼Œå†…å­˜ä¸­æ¥è¿˜æ˜¯è¯»å–æ–‡ä»¶æˆ–è€… HTTP æ‹‰å–ã€‚ä»è€Œå®ç°è·å–å’Œä½¿ç”¨çš„è§£è€¦ã€‚</p>
<p>è€Œä¸”è¿™æ ·çš„æ“ä½œå’ŒçŠ¶æ€å•å­éå¸¸éå¸¸åƒï¼Œå®é™…ä¸Šå®ƒå°±æ˜¯å’Œç›¸æ¯”çŠ¶æ€å•å­æ¥è¯´æ²¡æœ‰ä¿®æ”¹æ“ä½œçš„è¯»å–å™¨å•å­ï¼ˆReader Monadï¼‰åŒæ„ã€‚</p>
<p>ä¹Ÿå°±æ˜¯è¯´æŠŠæ‰§è¡Œå™¨å‡½æ•°ä½œä¸ºè¯»å–å™¨å•å­çš„çŠ¶æ€å¹¶åœ¨å‘ç”Ÿä½œç”¨çš„æ—¶å€™æ‰§è¡Œå¯¹åº”å‡½æ•°å°±å¯ä»¥è¾¾åˆ°å’Œç”¨ç»­å»¶å®ç°çš„ä»£æ•°ä½œç”¨ç›¸åŒçš„æ•ˆæœï¼Œåè¿‡æ¥ä¹ŸåŒæ ·å¯ä»¥æ¨¡æ‹Ÿã€‚</p>
</body>
</html>
