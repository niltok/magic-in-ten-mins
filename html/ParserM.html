<!DOCTYPE html><html lang="zh-CN" prefix="og: https://ogp.me/ns#">
<head >
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title >
ååˆ†é’Ÿé­”æ³•ç»ƒä¹ </title>
<style >
@font-face {
    font-family: "subset body font";
    src: url("body.woff2") format("woff2");
}

@font-face {
    font-family: "subset code font";
    src: url("code.woff2") format("woff2");
}

@font-face {
    font-family: "subset emoji font";
    src: url("emoji.woff2") format("woff2");
}

body {
    max-width: 35em;
    margin: auto;
    width: 90%;
    margin-top: 10%;
    margin-bottom: 10%;
    color: #0B0E26;
    background: #FAFAFC;
    line-height: 1.75em;
    text-rendering: optimizeLegibility;
    text-align: justify;
}

html {
    scroll-behavior: smooth;
    font-size: calc(min(.35vw + 16px, 25px));
    font-family: "subset body font", "Source Han Serif SC", "Noto Serif SC", "Songti SC", SimSun, "AR PL Sungti", "subset emoji font", serif;
}

h1 {
    font-size: 2.5rem;
    color: #EF96AB;
    line-height: 1.5em;
}

h2 {
    margin-top: 2rem;
    line-height: 1.5em;
}

h1,
h2,
h3 {
    /* text-align: center; */
}

blockquote {
    color: gray;
    margin: 0;
    padding: 1px 0 1px 1.2em;
    border-left: .3em solid #EF96AB;
}

code,
pre {
    font-size: 0.9rem;
    line-height: 1.8em;
    font-family: "subset code font", "ç­‰è·æ›´çº±é»‘ä½“ SC", "JetBrains Mono", "Fira Code", Menlo, Monaco, source-code-pro, Courier New, Consolas, "subset emoji font", monospace;
    background: #FCF6FC;
    border-radius: 3px;
    padding-inline: 0.3em;
}

pre {
    overflow-x: auto;
    padding: 1em 1.5em;
}

pre>code {
    padding-inline: 0;
}

::-webkit-scrollbar,
.element::-webkit-scrollbar,
.element {
    /* opacity: 0.5; */
}

a {
    color: #02AEF1;
    text-decoration: none;
}

@media (prefers-color-scheme: dark) {
    body {
        color: #D8D8D6;
        background: #0E0E10;
    }
}

@media (prefers-color-scheme: dark) {

    pre,
    code {
        color: #D8D8D6;
        background: #0E0F1F;
    }
}

.hljs-keyword {
    color: #F288AF;
}

.hljs-comment {
    color: #929CA6;
}

.hljs-string {
    color: #0594A6;
}

.hljs-title {
    color: #4581D9;
}

.hljs-type,
.hljs-built_in {
    color: #fca311;
}</style>
</head>
<body >
<p >
<a href="https://magic.huohuo.moe">ğŸ HomepageğŸ </a> | <a href="https://github.com/niltok/magic-in-ten-mins">â­Star me on GitHubâ­</a></p>
<h1 id="ååˆ†é’Ÿé­”æ³•ç»ƒä¹ ï¼šè§£æå™¨å•å­">ååˆ†é’Ÿé­”æ³•ç»ƒä¹ ï¼šè§£æå™¨å•å­</h1>
<h3 id="by-ã€Œç©ç«ã€">By ã€Œç©ç«ã€</h3>
<blockquote>
<p>å‰ç½®æŠ€èƒ½ï¼šJavaåŸºç¡€ï¼ŒHKTï¼ŒMonad</p>
</blockquote>
<p>è§£æå™¨ï¼ˆParserï¼‰æ˜¯ç¼–è¯‘å™¨çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒè¯»å–æºä»£ç ï¼ˆSource Codeï¼‰ï¼Œè¾“å‡ºä¸€ä¸ªæŠ½è±¡è¯­æ³•æ ‘ï¼ˆAbstract Syntax Tree, ASTï¼‰ã€‚æŸç§ç¨‹åº¦ä¸Šæ¥è¯´ï¼Œè§£æå™¨æ˜¯ä¸€ç§å¯ç»„åˆçš„ä¸œè¥¿ï¼Œå­—ç¬¦è§£æå™¨ç»„æˆäº†æ•´æ•°è§£æå™¨ï¼Œæ•´æ•°è§£æå™¨ç»„æˆäº†æµ®ç‚¹æ•°è§£æå™¨ã€‚</p>
<p>è¿™æ ·å¯ç»„åˆçš„è§£æå™¨æœ‰ä¸€ä¸ªæŠ½è±¡çš„å‡½æ•°è¡¨è¾¾ï¼š</p>
<pre><code class="language-java">Function&lt;ParseState, 
         Maybe&lt;Pair&lt;A, ParseState&gt;&gt;&gt;
</code></pre>
<p>å…¶ä¸­ <code>ParseState</code> æ˜¯åŒ…å«å½“å‰è§£æä½ç½®çš„æºæ–‡æœ¬çš„ç±»å‹ã€‚è¿”å›å€¼ç”¨ <code>Maybe</code> åŒ…èµ·æ¥å› ä¸ºè§£æå¯èƒ½å¤±è´¥ã€‚ <code>A</code> å°±æ˜¯è§£æå‡ºæ¥çš„å…·ä½“æ•°æ®ç±»å‹ã€‚è¿”å›å€¼ä¸­åŒ…æ‹¬è§£æåçš„çŠ¶æ€ <code>ParseState</code> ï¼Œè¿™æ ·å°±å¯ä»¥ä¼ é€’ç»™ä¸‹ä¸€ä¸ªè§£æå™¨å‡½æ•°ï¼Œä»è€Œç»„åˆå¤šä¸ªè§£æå™¨ã€‚</p>
<p>è€Œä¸”å¾ˆæ˜¾ç„¶è¿™ä¸ªå‡½æ•°æ˜¯ä¸€ä¸ª Monad ï¼Œä¸ºäº†ä¸ºå®ƒå®ç° Monad éœ€è¦ç”¨ HKT åŒ…è£…ä¸€ä¸‹ï¼š</p>
<pre><code class="language-java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Parser</span>&lt;<span class="hljs-title">A</span>&gt;
        <span class="hljs-keyword">implements</span> <span class="hljs-title">HKT</span>&lt;<span class="hljs-title">Parser</span>&lt;?&gt;, <span class="hljs-title">A</span>&gt; </span>{
    
    <span class="hljs-keyword">static</span> &lt;A&gt; <span class="hljs-function">Parser&lt;A&gt;
    <span class="hljs-title">narrow</span><span class="hljs-params">(HKT&lt;Parser&lt;?&gt;, A&gt; v)</span> </span>{
        <span class="hljs-keyword">return</span> (Parser&lt;A&gt;) v;
    }

    Function&lt;ParseState,
             Maybe&lt;Pair&lt;A, ParseState&gt;&gt;&gt;
                 parser;

    Parser(Function&lt;ParseState,
        Maybe&lt;Pair&lt;A, ParseState&gt;&gt;&gt; f) {
        parser = f;
    }

    Maybe&lt;Pair&lt;A, ParseState&gt;&gt;
    runParser(ParseState s) {
        <span class="hljs-keyword">return</span> parser.apply(s);
    }

    <span class="hljs-function">Maybe&lt;A&gt; <span class="hljs-title">parse</span><span class="hljs-params">(String s)</span> </span>{
        MaybeM m = <span class="hljs-keyword">new</span> MaybeM();
        <span class="hljs-keyword">return</span> Maybe.narrow(
                 m.flatMap(runParser(
                     <span class="hljs-keyword">new</span> ParseState(s)),
            r -&gt; m.pure(r.first)));
    }
}
</code></pre>
<p>ç„¶åå°±å¯ä»¥å®ç° Parser Monad äº†ï¼š</p>
<pre><code class="language-java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ParserM</span> 
    <span class="hljs-keyword">implements</span> <span class="hljs-title">Monad</span>&lt;<span class="hljs-title">Parser</span>&lt;?&gt;&gt; </span>{
    
    <span class="hljs-keyword">public</span> &lt;A&gt; HKT&lt;Parser&lt;?&gt;, A&gt; 
    pure(A v) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Parser&lt;&gt;(s -&gt;
               <span class="hljs-keyword">new</span> Maybe&lt;&gt;(
               <span class="hljs-keyword">new</span> Pair&lt;&gt;(v, s)));
    }

    <span class="hljs-keyword">public</span> &lt;A&gt; HKT&lt;Parser&lt;?&gt;, A&gt; 
    fail() {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Parser&lt;&gt;(s -&gt; 
               <span class="hljs-keyword">new</span> Maybe&lt;&gt;());
    }

    <span class="hljs-keyword">public</span> &lt;A, B&gt; HKT&lt;Parser&lt;?&gt;, B&gt;
    flatMap(HKT&lt;Parser&lt;?&gt;, A&gt; ma,
        Function&lt;A, 
            HKT&lt;Parser&lt;?&gt;, B&gt;&gt; f) {

        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Parser&lt;&gt;(s -&gt; {
            MaybeM m = <span class="hljs-keyword">new</span> MaybeM();
            <span class="hljs-comment">// ä¸€ç‚¹ä¼ªä»£ç (not Haskell)</span>
            <span class="hljs-comment">// do</span>
            <span class="hljs-comment">//   r &lt;- ma.runParser(s)</span>
            <span class="hljs-comment">//   f(r.first).runParser(</span>
            <span class="hljs-comment">//       r.second)</span>
            <span class="hljs-keyword">return</span> Maybe.narrow(
                     m.flatMap(Parser
                         .narrow(ma)
                         .runParser(s),
                r -&gt; Parser
                     .narrow(f.apply(
                         r.first))
                     .runParser(
                         r.second))
            );
        });
    }
}
</code></pre>
<p>å®ç°äº† Monad ä»¥åå†™ Parser å°±å¯ä»¥ä¸ç”¨ç®¡ç†é”™è¯¯å›æº¯ä¹Ÿä¸ç”¨æ‰‹åŠ¨ä¼ é€’è§£æçŠ¶æ€ï¼Œåªéœ€è¦æŠŠè§£æå™¨çœ‹æˆä¸€ä¸ªæŠ½è±¡çš„å®¹å™¨ï¼Œå–å‡ºè§£æç»“æœï¼Œç»„åˆï¼Œå†æ”¾å›å®¹å™¨ã€‚</p>
<p>è¿™é‡Œä¸¾ä¸¤ä¸ªç”¨ Parser Monad å†™çš„ç»„åˆå‡½æ•°ï¼š</p>
<pre><code class="language-java"><span class="hljs-comment">// class Parser&lt;A&gt;</span>
&lt;B&gt; <span class="hljs-function">Parser&lt;B&gt;
<span class="hljs-title">map</span><span class="hljs-params">(Function&lt;A, B&gt; f)</span> </span>{
    ParserM m = <span class="hljs-keyword">new</span> ParserM();
    <span class="hljs-comment">// do</span>
    <span class="hljs-comment">//   x &lt;- this</span>
    <span class="hljs-comment">//   pure (f(x))</span>
    <span class="hljs-keyword">return</span> narrow(
             m.flatMap(<span class="hljs-keyword">this</span>,
        x -&gt; m.pure(f.apply(x))));
}

&lt;B, C&gt; <span class="hljs-function">Parser&lt;C&gt;
<span class="hljs-title">combine</span><span class="hljs-params">(Parser&lt;B&gt; p,
        BiFunction&lt;A, B, C&gt; f)</span> </span>{
    ParserM m = <span class="hljs-keyword">new</span> ParserM();
    <span class="hljs-comment">// do</span>
    <span class="hljs-comment">//   a &lt;- this</span>
    <span class="hljs-comment">//   b &lt;- p</span>
    <span class="hljs-comment">//   pure (f(a, b))</span>
    <span class="hljs-keyword">return</span> narrow(
             m.flatMap(<span class="hljs-keyword">this</span>,
        a -&gt; m.flatMap(p,
        b -&gt; m.pure(f.apply(a, b)))));
}
</code></pre>
</body>
</html>
