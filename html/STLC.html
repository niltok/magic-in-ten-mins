<html>
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=0">
<title>
ååˆ†é’Ÿé­”æ³•ç»ƒä¹ </title>
<style>
body { max-width: 650px; margin: auto; width: 90%; margin-top: 10%; margin-bottom: 10%; color: #0B0E26; background: #FAFAFC; line-height: 2em; }
body { font-family: -apple-system,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Microsoft YaHei,Source Han Sans SC,Noto Sans CJK SC,WenQuanYi Micro Hei,sans-serif; }
h1 { font-size: 2.5em; color: #EF96AB; line-height: 1.5em; }
h2 { margin-top: 2em; line-height: 1.5em; }
blockquote { color: gray; margin: 0; padding: 1 1 1 20; border-left: 5px solid #EF96AB; }
code, pre { font-family: Consolas,Menlo,Monaco,source-code-pro,Courier New,monospace; background: #FCF6FC; }
pre { overflow-x: auto; padding: 10px; }
a { color: #02AEF1; text-decoration: none; }
@media (prefers-color-scheme: dark) { body { color: #D8D8D6; background: #0E0E10; } }
@media (prefers-color-scheme: dark) { pre, code { color: #D8D8D6; background: #0E0F1F; } }
.hljs-keyword { color: #F288AF; }
.hljs-comment { color: #929CA6; }
.hljs-string { color: #0594A6; }
.hljs-title { color: #4581D9 }
</style>
</head>
<body>
<p>
<a href="https://magic.huohuo.moe">ğŸ HomepageğŸ </a> | <a href="https://github.com/goldimax/magic-in-ten-mins">â­Star me on GitHubâ­</a></p>
<h1 id="ååˆ†é’Ÿé­”æ³•ç»ƒä¹ ï¼šç®€å•ç±»å‹-Î»-æ¼”ç®—">ååˆ†é’Ÿé­”æ³•ç»ƒä¹ ï¼šç®€å•ç±»å‹ Î» æ¼”ç®—</h1>
<h3 id="by-ã€Œç©ç«ã€">By ã€Œç©ç«ã€</h3>
<blockquote>
<p>å‰ç½®æŠ€èƒ½ï¼šJava åŸºç¡€ï¼ŒADTï¼ŒÎ» æ¼”ç®—</p>
</blockquote>
<h2 id="ç®€å•ç±»å‹-Î»-æ¼”ç®—">ç®€å•ç±»å‹ Î» æ¼”ç®—</h2>
<p>ç®€å•ç±»å‹ Î» æ¼”ç®—ï¼ˆSimply-Typed Lambda Calculusï¼‰æ˜¯åœ¨æ— ç±»å‹ Î» æ¼”ç®—ï¼ˆUntyped Lambda Calculusï¼‰çš„åŸºç¡€ä¸ŠåŠ äº†ä¸ªéå¸¸ç®€å•çš„ç±»å‹ç³»ç»Ÿã€‚</p>
<p>è¿™ä¸ªç±»å‹ç³»ç»ŸåŒ…å«ä¸¤ç§ç±»å‹ç»“æ„ï¼Œä¸€ç§æ˜¯å†…å»ºçš„åŸºç¡€ç±»å‹ <code>T</code> ï¼Œä¸€ç§æ˜¯å‡½æ•°ç±»å‹ <code>A â†’ B</code> ï¼Œå…¶ä¸­å‡½æ•°ç±»å‹ç”±æºç±»å‹ <code>A</code> å’Œç›®æ ‡ç±»å‹ <code>B</code> ç»„æˆï¼š</p>
<pre><code>Type = BaseType + FunctionType
FunctionType = Type * Type</code></pre>
<p>æ³¨æ„å‡½æ•°ç±»å‹çš„ç¬¦å·æ˜¯å³ç»“åˆçš„ï¼Œä¹Ÿå°±æ˜¯è¯´ <code>A â†’ A â†’ A</code> ç­‰ä»·äº <code>A â†’ (A â†’ A)</code> ã€‚</p>
<p>ç”¨ Java ä»£ç å¯ä»¥è¡¨ç¤ºä¸ºï¼š</p>
<pre><code class="language-java"><span class="hljs-comment">// æ„é€ å‡½æ•°ï¼Œ equals å·²çœå»</span>
<span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">Type</span> </span>{}
<span class="hljs-comment">// BaseType</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TVal</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Type</span> </span>{
    String name;
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">toString</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> name;
    }
}
<span class="hljs-comment">// FunctionType</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TArr</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Type</span> </span>{
    Type src, tar;
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">toString</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;(&quot;</span> + src + <span class="hljs-string">&quot; â†’ &quot;</span> + tar + <span class="hljs-string">&quot;)&quot;</span>;
    }
}</code></pre>
<h2 id="å¹´è½»äººçš„ç¬¬ä¸€ä¸ª-typechecker">å¹´è½»äººçš„ç¬¬ä¸€ä¸ª TypeChecker</h2>
<p>ç„¶åéœ€æŠŠç±»å‹åµŒå…¥åˆ° Î» æ¼”ç®—çš„è¯­æ³•æ ‘ä¸­ï¼š</p>
<pre><code class="language-java"><span class="hljs-comment">// æ„é€ å‡½æ•°ï¼Œ toString å·²çœå»</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Val</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Expr</span> </span>{
    String x;
    Type type;
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Fun</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Expr</span> </span>{
    Val x;
    Expr e;
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">App</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Expr</span> </span>{
    Expr f, x;
}</code></pre>
<p>æ³¨æ„åªæœ‰å‡½æ•°å®šä¹‰çš„å˜é‡éœ€è¦æ ‡è®°ç±»å‹ï¼Œè¡¨è¾¾å¼çš„ç±»å‹æ˜¯å¯ä»¥è¢«ç®€å•æ¨å¯¼å‡ºçš„ã€‚åŒæ—¶è¿˜éœ€è¦ä¸€ä¸ªç¯å¢ƒæ¥ä¿å­˜å®šä¹‰å˜é‡çš„ç±»å‹ï¼ˆå…¶å®æ˜¯ä¸€ä¸ªä¸å¯å˜é“¾è¡¨ï¼‰ï¼š</p>
<pre><code class="language-java"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">Env</span> </span>{
    <span class="hljs-function">Type <span class="hljs-title">lookup</span><span class="hljs-params">(String s)</span> <span class="hljs-keyword">throws</span> BadTypeException</span>;
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">NilEnv</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Env</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">public</span> Type <span class="hljs-title">lookup</span><span class="hljs-params">(String s)</span> <span class="hljs-keyword">throws</span> BadTypeException </span>{
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> BadTypeException();
    }
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ConsEnv</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Env</span> </span>{
    Val v;
    Env next;
    <span class="hljs-function"><span class="hljs-keyword">public</span> Type <span class="hljs-title">lookup</span><span class="hljs-params">(String s)</span> <span class="hljs-keyword">throws</span> BadTypeException </span>{
        <span class="hljs-keyword">if</span> (s.equals(v.x)) <span class="hljs-keyword">return</span> v.type;
        <span class="hljs-keyword">return</span> next.lookup(s);
    }
}</code></pre>
<p>è€Œå¯¹äºè¿™æ ·ç®€å•çš„æ¨¡å‹ï¼Œç±»å‹æ£€æŸ¥åªéœ€è¦åˆ¤æ–­ <code>F X</code> ä¸­çš„ <code>F</code> éœ€è¦æ˜¯å‡½æ•°ç±»å‹ï¼Œå¹¶ä¸” <code>(Î» x. F) E</code> ä¸­ <code>x</code> çš„ç±»å‹å’Œ <code>E</code> çš„ç±»å‹ä¸€è‡´ã€‚</p>
<p>è€Œç±»å‹æ¨å¯¼ä¹Ÿå¾ˆç®€å•ï¼šå˜é‡çš„ç±»å‹å°±æ˜¯å®ƒè¢«æ ‡è®°çš„ç±»å‹ï¼›å‡½æ•°å®šä¹‰çš„ç±»å‹å°±æ˜¯ä»¥å®ƒå˜é‡çš„æ ‡è®°ç±»å‹ä¸ºæºï¼Œå®ƒå‡½æ•°ä½“çš„ç±»å‹ä¸ºç›®æ ‡çš„å‡½æ•°ç±»å‹ï¼›è€Œå‡½æ•°åº”ç”¨çš„ç±»å‹å°±æ˜¯å‡½æ•°çš„ç›®æ ‡ç±»å‹ï¼Œåœ¨èƒ½é€šè¿‡ç±»å‹æ£€æŸ¥çš„æƒ…å†µä¸‹ã€‚</p>
<p>ä»¥ä¸Šç”¨ Java ä»£ç æè¿°å°±æ˜¯ï¼š</p>
<pre><code class="language-java"><span class="hljs-comment">// æ„é€ å‡½æ•°ï¼Œ toString å·²çœå»</span>
<span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">Expr</span> </span>{
    <span class="hljs-function">Type <span class="hljs-title">checkType</span><span class="hljs-params">(Env env)</span> <span class="hljs-keyword">throws</span> BadTypeException</span>;
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Val</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Expr</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">public</span> Type <span class="hljs-title">checkType</span><span class="hljs-params">(Env env)</span> <span class="hljs-keyword">throws</span> BadTypeException </span>{
        <span class="hljs-keyword">if</span> (type != <span class="hljs-keyword">null</span>) <span class="hljs-keyword">return</span> type;
        <span class="hljs-keyword">return</span> env.lookup(x);
    }
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Fun</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Expr</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">public</span> Type <span class="hljs-title">checkType</span><span class="hljs-params">(Env env)</span> <span class="hljs-keyword">throws</span> BadTypeException </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> TArr(x.type, e.checkType(<span class="hljs-keyword">new</span> ConsEnv(x, env)));
    }
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">App</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Expr</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">public</span> Type <span class="hljs-title">checkType</span><span class="hljs-params">(Env env)</span> <span class="hljs-keyword">throws</span> BadTypeException </span>{
        Type tf = f.checkType(env);
        <span class="hljs-keyword">if</span> (tf <span class="hljs-keyword">instanceof</span> TArr &amp;&amp;
                ((TArr) tf).src.equals(x.checkType(env)))
            <span class="hljs-keyword">return</span> ((TArr) tf).tar;
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> BadTypeException();
    }
}</code></pre>
<p>ä¸‹é¢çš„æµ‹è¯•ä»£ç å¯¹</p>
<pre><code>(Î» (x: <span class="hljs-keyword">int</span>). (Î» (y: <span class="hljs-keyword">int</span> â†’ bool). (y x)))</code></pre>
<p>è¿›è¡Œäº†ç±»å‹æ£€æŸ¥ï¼Œä¼šæ‰“å°è¾“å‡º <code>(int â†’ ((int â†’ bool) â†’ bool))</code> ï¼š</p>
<pre><code class="language-java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">STLambda</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> BadTypeException </span>{
        System.out.println(
            <span class="hljs-keyword">new</span> Fun(<span class="hljs-keyword">new</span> Val(<span class="hljs-string">&quot;x&quot;</span>, <span class="hljs-keyword">new</span> TVal(<span class="hljs-string">&quot;int&quot;</span>)),
            <span class="hljs-keyword">new</span> Fun(<span class="hljs-keyword">new</span> Val(<span class="hljs-string">&quot;y&quot;</span>, <span class="hljs-keyword">new</span> TArr(<span class="hljs-keyword">new</span> TVal(<span class="hljs-string">&quot;int&quot;</span>), <span class="hljs-keyword">new</span> TVal(<span class="hljs-string">&quot;bool&quot;</span>))),
                <span class="hljs-keyword">new</span> App(<span class="hljs-keyword">new</span> Val(<span class="hljs-string">&quot;y&quot;</span>), <span class="hljs-keyword">new</span> Val(<span class="hljs-string">&quot;x&quot;</span>)))).checkType(<span class="hljs-keyword">new</span> NilEnv()));
    }
}</code></pre>
<p>è€Œå¦‚æœå¯¹</p>
<pre><code>(Î» (x: bool). (Î» (y: <span class="hljs-keyword">int</span> â†’ bool). (y x)))</code></pre>
<p>è¿›è¡Œç±»å‹æ£€æŸ¥å°±ä¼šæŠ›å‡º <code>BadTypeException</code> ã€‚</p>
</body>
</html>
