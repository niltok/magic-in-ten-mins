<html>
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=0">
<title>
ååˆ†é’Ÿé­”æ³•ç»ƒä¹ </title>
<style>
body { max-width: 650px; margin: auto; width: 90%; margin-top: 10%; margin-bottom: 10%; color: #0B0E26; background: #FAFAFC; line-height: 2em; }
body { font-family: -apple-system,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Microsoft YaHei,Source Han Sans SC,Noto Sans CJK SC,WenQuanYi Micro Hei,sans-serif; }
h1 { font-size: 2.5em; color: #EF96AB; line-height: 1.5em; }
h2 { margin-top: 2em; line-height: 1.5em; }
blockquote { color: gray; margin: 0; padding: 1 1 1 20; border-left: 5px solid #EF96AB; }
code, pre { font-family: Consolas,Menlo,Monaco,source-code-pro,Courier New,monospace; background: #FCF6FC; }
pre { overflow-x: auto; padding: 10px; }
a { color: #02AEF1; text-decoration: none; }
@media (prefers-color-scheme: dark) { body { color: #D8D8D6; background: #0E0E10; } }
@media (prefers-color-scheme: dark) { pre, code { color: #D8D8D6; background: #0E0F1F; } }
.hljs-keyword { color: #F288AF; }
.hljs-comment { color: #929CA6; }
.hljs-string { color: #0594A6; }
.hljs-title { color: #4581D9 }
</style>
</head>
<body>
<p>
<a href="https://magic.huohuo.moe">ğŸ HomepageğŸ </a> | <a href="https://github.com/niltok/magic-in-ten-mins">â­Star me on GitHubâ­</a></p>
<h1 id="ååˆ†é’Ÿé­”æ³•ç»ƒä¹ ï¼šè§£æå™¨ç»„åˆå­">ååˆ†é’Ÿé­”æ³•ç»ƒä¹ ï¼šè§£æå™¨ç»„åˆå­</h1>
<h3 id="by-ã€Œç©ç«ã€">By ã€Œç©ç«ã€</h3>
<blockquote>
<p>å‰ç½®æŠ€èƒ½ï¼šJavaåŸºç¡€ï¼ŒHKTï¼ŒMonad</p>
</blockquote>
<h2 id="å¸¸è§ç»„åˆå­">å¸¸è§ç»„åˆå­</h2>
<p>è§£æå™¨å•å­é‚£æœŸçš„æœ€åç»™å‡ºäº† <code>map</code> å’Œ <code>combine</code> çš„å®šä¹‰ï¼Œè€Œ <code>combine</code> å¯ä»¥è¿›ä¸€æ­¥ç»„åˆå‡ºåªå–è‡ªå·±ç»“æœå’Œåªå–å‚æ•°ç»“æœçš„ç»„åˆå­ï¼š</p>
<pre><code class="language-java"><span class="hljs-comment">// class Parser&lt;A&gt;</span>

<span class="hljs-comment">// å¿½ç•¥å‚æ•°è§£æå™¨çš„è§£æç»“æœ</span>
&lt;B&gt; <span class="hljs-function">Parser&lt;A&gt;
<span class="hljs-title">skip</span><span class="hljs-params">(Parser&lt;B&gt; p)</span> </span>{
    <span class="hljs-keyword">return</span> combine(p, (a, b) -&gt; a);
}
<span class="hljs-comment">// ä½¿ç”¨å‚æ•°è§£æå™¨çš„è§£æç»“æœ</span>
&lt;B&gt; <span class="hljs-function">Parser&lt;B&gt;
<span class="hljs-title">use</span><span class="hljs-params">(Parser&lt;B&gt; p)</span> </span>{
    <span class="hljs-keyword">return</span> combine(p, (a, b) -&gt; b);
}</code></pre>
<p><code>or</code> ç»„åˆå­å¯ä»¥åœ¨è§£æå¤±è´¥çš„æ—¶å€™ç”¨å‚æ•°è§£æå™¨æ¥é‡æ–°è§£æï¼š</p>
<pre><code class="language-java"><span class="hljs-comment">// class Parser&lt;A&gt;</span>
<span class="hljs-function">Parser&lt;A&gt;
<span class="hljs-title">or</span><span class="hljs-params">(Parser&lt;A&gt; p)</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Parser&lt;&gt;(s -&gt; {
        Maybe&lt;Pair&lt;A, ParseState&gt;&gt;
            r = runParser(s);
        <span class="hljs-keyword">if</span> (r.value == <span class="hljs-keyword">null</span>)
            <span class="hljs-keyword">return</span> p.runParser(s);
        <span class="hljs-keyword">return</span> r;
    });
}</code></pre>
<p><code>many</code> ç»„åˆå­ç”¨æ¥æ„é€ åŒ¹é…ä»»æ„ä¸ªç›¸åŒçš„è§£æå™¨çš„è§£æå™¨ï¼Œç”¨äº† List æ¥è¿”å›ç»“æœï¼Œæ‰€ä»¥ä»£ç æ¯”è¾ƒå¤æ‚ï¼š</p>
<pre><code class="language-java"><span class="hljs-comment">// class Parser&lt;A&gt;</span>
Parser&lt;List&lt;A&gt;&gt;
many() {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Parser&lt;&gt;(s -&gt; {
        Maybe&lt;Pair&lt;A, ParseState&gt;&gt;
            r = runParser(s);
        <span class="hljs-keyword">if</span> (r.value == <span class="hljs-keyword">null</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Maybe&lt;&gt;(
                <span class="hljs-keyword">new</span> Pair&lt;&gt;(
                <span class="hljs-keyword">new</span> ArrayList&lt;&gt;(), s));
        Maybe&lt;Pair&lt;List&lt;A&gt;, ParseState&gt;&gt;
            rs = many().runParser(
                        r.value.second);
        rs.value.first.add(<span class="hljs-number">0</span>,
                         r.value.first);
        <span class="hljs-keyword">return</span> rs;
    });
}</code></pre>
<p><code>some</code> ç»„åˆå­åˆ©ç”¨ <code>many</code> å®šä¹‰ï¼Œç”¨æ¥æ„é€ åŒ¹é…ä¸€ä¸ªåŠä»¥ä¸Šç›¸åŒçš„è§£æå™¨çš„è§£æå™¨ï¼š</p>
<pre><code class="language-java"><span class="hljs-comment">// class Parser&lt;A&gt;</span>
Parser&lt;List&lt;A&gt;&gt;
some() {
    <span class="hljs-keyword">return</span> combine(many(), (x, xs) -&gt; {
        xs.add(<span class="hljs-number">0</span>, x);
        <span class="hljs-keyword">return</span> xs;
    });
}</code></pre>
<h2 id="å¸¸è§è§£æå™¨">å¸¸è§è§£æå™¨</h2>
<p>æœ€åŸºæœ¬çš„æ˜¯ <code>id</code> è§£æå™¨ï¼Œè§£æä»»æ„ä¸€ä¸ªå­—ç¬¦å¹¶ä½œä¸ºè§£æç»“æœè¿”å›ï¼š</p>
<pre><code class="language-java"><span class="hljs-keyword">static</span> Parser&lt;Character&gt; id =
        <span class="hljs-keyword">new</span> Parser&lt;&gt;(s -&gt; {

    <span class="hljs-keyword">if</span> (s.p == s.s.length())
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Maybe&lt;&gt;();

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Maybe&lt;&gt;(
        <span class="hljs-keyword">new</span> Pair&lt;&gt;(s.s.charAt(s.p),
                    s.next()));

});</code></pre>
<p>æœ‰äº† <code>id</code> è§£æå™¨ä¹‹åæ„é€ çš„è§£æå™¨å°±åªéœ€è¦æŠŠ <code>id</code> å’Œç»„åˆå­ç»„åˆè€Œä¸éœ€è¦å†å…³å¿ƒè§£æä¸€ä¸ªå­—ç¬¦çš„ç»†èŠ‚ã€‚</p>
<p>æœ€å¸¸ç”¨çš„è§£æå™¨å°±æ˜¯ <code>pred</code> ï¼Œè§£æä¸€ä¸ªç¬¦åˆè¦æ±‚çš„å­—ç¬¦ï¼š</p>
<pre><code class="language-java"><span class="hljs-function"><span class="hljs-keyword">static</span> Parser&lt;Character&gt;
<span class="hljs-title">pred</span><span class="hljs-params">(Predicate&lt;Character&gt; f)</span> </span>{
    ParserM m = <span class="hljs-keyword">new</span> ParserM();
    <span class="hljs-keyword">return</span> narrow(
              m.flatMap(id,
         c -&gt; f.test(c) ?
                  m.pure(c) :
                  m.fail()));
}</code></pre>
<p>å¦ä¸€ä¸ªå¸¸ç”¨çš„è§£æå™¨æ˜¯ <code>character</code> ï¼Œè§£æç‰¹å®šå­—ç¬¦ï¼š</p>
<pre><code class="language-java"><span class="hljs-function"><span class="hljs-keyword">static</span> Parser&lt;Character&gt;
<span class="hljs-title">character</span><span class="hljs-params">(<span class="hljs-keyword">char</span> x)</span> </span>{
    <span class="hljs-keyword">return</span> pred(c -&gt; c == x);
}</code></pre>
<h2 id="ç»„åˆ">ç»„åˆ</h2>
<p>æ—¢ç„¶å«è§£æå™¨ç»„åˆå­ï¼Œé‚£ä¹ˆå®ƒä»¬æ˜¯ç”¨æ¥ç»„åˆçš„ï¼Œè¿™é‡Œç»™å‡ºå¦‚ä½•ç”¨å®ƒä»¬ç»„åˆå‡ºä¸€ä¸ªè§£ææµ®ç‚¹æ•°çš„è§£æå™¨ä¾‹å­ï¼š</p>
<pre><code class="language-java"><span class="hljs-comment">// è§£æä¸€ä¸ªæ•°å­—å­—ç¬¦</span>
<span class="hljs-keyword">static</span> Parser&lt;Integer&gt; digit =
    pred(c -&gt; <span class="hljs-string">&#x27;0&#x27;</span> &lt;= c &amp;&amp; c &lt;= <span class="hljs-string">&#x27;9&#x27;</span>)
                    p(c -&gt; c - <span class="hljs-string">&#x27;0&#x27;</span>);
<span class="hljs-comment">// è§£æä¸€ä¸ªè‡ªç„¶æ•°</span>
<span class="hljs-keyword">static</span> Parser&lt;Integer&gt; nat =
        digit.some().map(xs -&gt; {
    <span class="hljs-keyword">int</span> x = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i : xs) x = x * <span class="hljs-number">10</span> + i;
    <span class="hljs-keyword">return</span> x;
});
<span class="hljs-comment">// è§£æä¸€ä¸ªæ•´æ•°</span>
<span class="hljs-keyword">static</span> Parser&lt;Integer&gt; integer =
    (character(<span class="hljs-string">&#x27;-&#x27;</span>).use(nat).map(x -&gt; -x))
                   .or(nat);
<span class="hljs-comment">// è§£æä¸€ä¸ªæµ®ç‚¹æ•°</span>
<span class="hljs-keyword">static</span> Parser&lt;Double&gt; real =
    (integer.combine(character(<span class="hljs-string">&#x27;.&#x27;</span>)
        .use(digit.some()).map(xs -&gt; {
            <span class="hljs-keyword">double</span> ans = <span class="hljs-number">0</span>, base = <span class="hljs-number">0.1</span>;
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i : xs) {
                    ans += base * i;
                    base *= <span class="hljs-number">0.1</span>;
                }
                <span class="hljs-keyword">return</span> ans;
            }),
            Double::sum)).or(integer
            .map(Integer::doubleValue));</code></pre>
</body>
</html>
