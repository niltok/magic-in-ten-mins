<html>
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=0">
<title>
ååˆ†é’Ÿé­”æ³•ç»ƒä¹ </title>
<style>
body { max-width: 650px; margin: auto; width: 90%; margin-top: 10%; margin-bottom: 10%; color: #0B0E26; background: #FAFAFC; line-height: 2em; font-variant-ligatures: common-ligatures discretionary-ligatures; -webkit-font-feature-settings: "liga" on, "calt" on; font-feature-settings: "liga" on, "calt" on; }
body { font-size: 20px; font-family: -apple-system,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Microsoft YaHei,Source Han Sans SC,Noto Sans CJK SC,WenQuanYi Micro Hei,sans-serif; }
h1 { font-size: 2.5em; color: #EF96AB; line-height: 1.5em; }
h2 { margin-top: 2em; line-height: 1.5em; }
blockquote { color: gray; margin: 0; padding: 1 1 1 20; border-left: 5px solid #EF96AB; }
code, pre { font-size: 0.9em; line-height: 1.8em; font-family: "JetBrains Mono","ç­‰è·æ›´çº±é»‘ä½“ SC","Fira Code",Menlo,Monaco,source-code-pro,Courier New,Consolas,monospace; background: #FCF6FC; border-radius: 3px; padding-inline: 0.3rem; }
pre { overflow-x: auto; padding: 1rem; }
pre>code { padding-inline: 0; }
a { color: #02AEF1; text-decoration: none; }
@media (prefers-color-scheme: dark) { body { color: #D8D8D6; background: #0E0E10; } }
@media (prefers-color-scheme: dark) { pre, code { color: #D8D8D6; background: #0E0F1F; } }
.hljs-keyword { color: #F288AF; }
.hljs-comment { color: #929CA6; }
.hljs-string { color: #0594A6; }
.hljs-title { color: #4581D9; }
.hljs-type, .hljs-built_in { color: #fca311; }
</style>
</head>
<body>
<p>
<a href="https://magic.huohuo.moe">ğŸ HomepageğŸ </a> | <a href="https://github.com/niltok/magic-in-ten-mins">â­Star me on GitHubâ­</a></p>
<h1 id="ååˆ†é’Ÿé­”æ³•ç»ƒä¹ ï¼šé«˜é˜¶ç±»å‹">ååˆ†é’Ÿé­”æ³•ç»ƒä¹ ï¼šé«˜é˜¶ç±»å‹</h1>
<h3 id="by-ã€Œç©ç«ã€">By ã€Œç©ç«ã€</h3>
<blockquote>
<p>å‰ç½®æŠ€èƒ½ï¼šJavaåŸºç¡€</p>
</blockquote>
<h2 id="å¸¸å¸¸ç¢°åˆ°çš„å›°éš¾">å¸¸å¸¸ç¢°åˆ°çš„å›°éš¾</h2>
<p>å†™ä»£ç çš„æ—¶å€™å¸¸å¸¸ä¼šç¢°åˆ°è¯­è¨€è¡¨è¾¾èƒ½åŠ›ä¸è¶³çš„é—®é¢˜ï¼Œæ¯”å¦‚ä¸‹é¢è¿™æ®µç”¨æ¥ç»™ <code>F</code> å®¹å™¨ä¸­çš„å€¼è¿›è¡Œæ˜ å°„çš„ä»£ç ï¼š</p>
<pre><code class="language-java"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">Functor</span>&lt;<span class="hljs-title">F</span>&gt; </span>{
    &lt;A, B&gt;
    <span class="hljs-function">F&lt;B&gt; <span class="hljs-title">map</span><span class="hljs-params">(F&lt;A&gt; a, Function&lt;A, B&gt; f)</span></span>;
}
</code></pre>
<p>å¹¶ä¸èƒ½é€šè¿‡ <code>javac</code> çš„ç¼–è¯‘ï¼Œç¼–è¯‘å™¨ä¼šå‘Šè¯‰ä½ Fä¸èƒ½æœ‰æ³›å‹å‚æ•°ã€‚</p>
<p>æœ€ç®€å•ç²—æš´çš„è§£å†³æ–¹æ¡ˆå°±æ˜¯æ”¾å¼ƒç±»å‹æ£€æŸ¥ï¼Œå…¨ä¸Š <code>Object</code> ï¼Œå¦‚ï¼š</p>
<pre><code class="language-java"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">Functor</span>&lt;<span class="hljs-title">F</span>&gt; </span>{
    <span class="hljs-function">Object <span class="hljs-title">map</span><span class="hljs-params">(Object a, 
               Function&lt;Object, Object&gt; f)</span></span>;
}
</code></pre>
<p>å®é™…ä¸ŠJavaç»å¸¸è¿™ä¹ˆå¹²ï¼Œæ ‡å‡†åº“ä¸­åˆ°å¤„æ˜¯ <code>Object</code> çš„èº«å½±ï¼Œé‡è½½çš„å„ç§æ¥å£ä¹Ÿå¸¸å¸¸è¦æ‰‹å·¥è½¬æ¢ç±»å‹ï¼Œ <code>equals</code> è¦å’Œ <code>Object</code> æ¯”è¾ƒï¼Œ <code>compareTo</code> è¦å’Œ <code>Object</code> æ¯”è¾ƒâ€¦â€¦ä¼¼ä¹ä¹ æƒ¯äº†ä»¥åä¹ŸæŒºå¥½ï¼Œåˆä¸æ˜¯ä¸èƒ½ç”¨ï¼</p>
<h2 id="é«˜é˜¶ç±»å‹">é«˜é˜¶ç±»å‹</h2>
<p>å‡è®¾ç±»å‹çš„ç±»å‹æ˜¯ <code>Type</code> ï¼Œæ¯”å¦‚ <code>int</code> å’Œ <code>String</code> ç±»å‹éƒ½æ˜¯ <code>Type</code> ã€‚</p>
<p>è€Œå¯¹äº <code>List</code> è¿™æ ·å¸¦æœ‰ä¸€ä¸ªæ³›å‹å‚æ•°çš„ç±»å‹æ¥è¯´ï¼Œå®ƒç›¸å½“äºä¸€ä¸ªæŠŠç±»å‹ <code>T</code> æ˜ å°„åˆ° <code>List&lt;T&gt;</code> çš„å‡½æ•°ï¼Œå…¶ç±»å‹å¯ä»¥è¡¨ç¤ºä¸º <code>Type -&gt; Type</code> ã€‚</p>
<p>åŒæ ·çš„å¯¹äº <code>Map</code> æ¥è¯´å®ƒæœ‰ä¸¤ä¸ªæ³›å‹å‚æ•°ï¼Œç±»å‹å¯ä»¥è¡¨ç¤ºä¸º <code>(Type, Type) -&gt; Type</code> ã€‚</p>
<p>åƒè¿™æ ·æŠŠç±»å‹æ˜ å°„åˆ°ç±»å‹çš„éå¹³å‡¡ç±»å‹å°±å«é«˜é˜¶ç±»å‹ï¼ˆHKT, Higher Kinded Typeï¼‰ã€‚</p>
<p>è™½ç„¶Javaä¸­å­˜åœ¨è¿™æ ·çš„é«˜é˜¶ç±»å‹ä½†æ˜¯æˆ‘ä»¬å¹¶ä¸èƒ½ç”¨ä¸€ä¸ªæ³›å‹å‚æ•°è¡¨ç¤ºå‡ºæ¥ï¼Œä¹Ÿå°±ä¸èƒ½å†™å‡ºå¦‚ä¸Š <code>F&lt;A&gt;</code> è¿™æ ·çš„ä»£ç äº†ï¼Œå› ä¸º <code>F</code> æ˜¯ä¸ªé«˜é˜¶ç±»å‹ã€‚</p>
<blockquote>
<p>å¦‚æœåŠ ä¸€å±‚è§£å†³ä¸äº†é—®é¢˜ï¼Œé‚£å°±åŠ ä¸¤å±‚ã€‚</p>
</blockquote>
<p>è™½ç„¶åœ¨Javaä¸­ä¸èƒ½ç›´æ¥è¡¨ç¤ºå‡ºé«˜é˜¶ç±»å‹ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡åŠ ä¸€ä¸ªä¸­é—´å±‚æ¥åœ¨ä¿ç•™å®Œæ•´ä¿¡æ¯çš„æƒ…å†µä¸‹å¼ºç±»å‹åœ°æ¨¡æ‹Ÿå‡ºé«˜é˜¶ç±»å‹ã€‚</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªä¸­é—´å±‚ï¼š</p>
<pre><code class="language-java"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">HKT</span>&lt;<span class="hljs-title">F</span>, <span class="hljs-title">A</span>&gt; </span>{}
</code></pre>
<p>ç„¶åæˆ‘ä»¬å°±å¯ä»¥ç”¨ <code>HKT&lt;F, A&gt;</code> æ¥è¡¨ç¤º <code>F&lt;A&gt;</code> ï¼Œè¿™æ ·æ“ä½œå®Œ <code>HKT&lt;F, A&gt;</code> åæˆ‘ä»¬ä»ç„¶æœ‰å®Œæ•´çš„ç±»å‹ä¿¡æ¯æ¥è¿˜åŸ <code>F&lt;A&gt;</code> çš„ç±»å‹ã€‚</p>
<p>è¿™æ ·ï¼Œä¸Šé¢ <code>Functor</code> å°±å¯ä»¥å†™æˆï¼š</p>
<pre><code class="language-java"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">Functor</span>&lt;<span class="hljs-title">F</span>&gt; </span>{
    &lt;A, B&gt; 
    <span class="hljs-function">HKT&lt;F, B&gt; <span class="hljs-title">map</span><span class="hljs-params">(HKT&lt;F, A&gt; ma, 
                  Function&lt;A, B&gt; f)</span></span>;
}
</code></pre>
<p>è¿™æ ·å°±å¯ä»¥ç¼–è¯‘é€šè¿‡äº†ã€‚è€Œå¯¹äºæƒ³å®ç° <code>Functor</code> çš„ç±»ï¼Œéœ€è¦å…ˆå®ç° <code>HKT</code> è¿™ä¸ªä¸­é—´å±‚ï¼Œè¿™é‡Œæ‹¿ <code>List</code> ä¸¾ä¾‹ï¼š</p>
<pre><code class="language-java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HKTList</span>&lt;<span class="hljs-title">A</span>&gt; 
    <span class="hljs-keyword">implements</span> <span class="hljs-title">HKT</span>&lt;<span class="hljs-title">HKTList</span>&lt;?&gt;, <span class="hljs-title">A</span>&gt; </span>{
    
    List&lt;A&gt; value;
    
    HKTList() {
        value = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();
    }
    
    HKTList(List&lt;A&gt; v) {
        value = v;
    }
    
    <span class="hljs-keyword">static</span> &lt;T&gt; <span class="hljs-function">HKTList&lt;T&gt;
    <span class="hljs-title">narrow</span><span class="hljs-params">(HKT&lt;HKTList&lt;?&gt;, T&gt; v)</span> </span>{
        <span class="hljs-keyword">return</span> (HKTList&lt;T&gt;) v;
    }
    
    <span class="hljs-keyword">static</span> &lt;T&gt; Collector&lt;T, ?, HKTList&lt;T&gt;&gt;
    collector() { <span class="hljs-comment">/* ... */</span> }
}
</code></pre>
<p>æ³¨æ„ <code>HKTList</code> æŠŠè‡ªå·±ä½œä¸ºäº† <code>HKT</code> çš„ç¬¬ä¸€ä¸ªå‚æ•°æ¥ä¿å­˜è‡ªå·±çš„ç±»å‹ä¿¡æ¯ï¼Œè¿™æ ·å¯¹äº <code>HKT&lt;HKTList&lt;?&gt;, T&gt;</code> è¿™ä¸ªæ¥å£æ¥è¯´å°±åªæœ‰è‡ªå·±è¿™ä¸€ä¸ªå­ç±»ï¼Œè€Œåœ¨ <code>narrow</code> å‡½æ•°ä¸­å¯ä»¥å®‰å…¨åœ°æŠŠè¿™ä¸ªå”¯ä¸€å­ç±»è½¬æ¢å›æ¥ã€‚</p>
<p>è¿™æ ·ï¼Œå®ç° <code>Functor</code> ç±»å°±æ˜¯ä¸€ä»¶ç®€å•çš„äº‹æƒ…äº†ï¼š</p>
<pre><code class="language-java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ListF</span>
    <span class="hljs-keyword">implements</span> <span class="hljs-title">Functor</span>&lt;<span class="hljs-title">HKTList</span>&lt;?&gt;&gt; </span>{

    <span class="hljs-keyword">public</span> &lt;A, B&gt; HKT&lt;HKTList&lt;?&gt;, B&gt;
    map(HKT&lt;HKTList&lt;?&gt;, A&gt; ma, 
        Function&lt;A, B&gt; f) {
        
        <span class="hljs-keyword">return</span> HKTList.narrow(ma)
            .value.stream().map(f)
            .collect(HKTList.collector());
    }
}
</code></pre>
</body>
</html>
