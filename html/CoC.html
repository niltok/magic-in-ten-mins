<html>
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=0">
<title>
ååˆ†é’Ÿé­”æ³•ç»ƒä¹ </title>
<style>
body { max-width: 650px; margin: auto; width: 90%; margin-top: 10%; margin-bottom: 10%; color: #0B0E26; background: #FAFAFC; line-height: 2em; }
body { font-family: -apple-system,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Microsoft YaHei,Source Han Sans SC,Noto Sans CJK SC,WenQuanYi Micro Hei,sans-serif; }
h1 { font-size: 2.5em; color: #EF96AB; line-height: 1.5em; }
h2 { margin-top: 2em; line-height: 1.5em; }
blockquote { color: gray; margin: 0; padding: 1 1 1 20; border-left: 5px solid #EF96AB; }
code, pre { font-family: Consolas,Menlo,Monaco,source-code-pro,Courier New,monospace; background: #FCF6FC; }
pre { overflow-x: auto; padding: 10px; }
a { color: #02AEF1; text-decoration: none; }
@media (prefers-color-scheme: dark) { body { color: #D8D8D6; background: #0E0E10; } }
@media (prefers-color-scheme: dark) { pre, code { color: #D8D8D6; background: #0E0F1F; } }
.hljs-keyword { color: #F288AF; }
.hljs-comment { color: #929CA6; }
.hljs-string { color: #0594A6; }
.hljs-title { color: #4581D9 }
</style>
</head>
<body>
<p>
<a href="https://magic.huohuo.moe">ğŸ HomepageğŸ </a> | <a href="https://github.com/goldimax/magic-in-ten-mins">â­Star me on GitHubâ­</a></p>
<h1 id="ååˆ†é’Ÿé­”æ³•ç»ƒä¹ ï¼šæ„é€ æ¼”ç®—">ååˆ†é’Ÿé­”æ³•ç»ƒä¹ ï¼šæ„é€ æ¼”ç®—</h1>
<h3 id="by-ã€Œç©ç«ã€">By ã€Œç©ç«ã€</h3>
<blockquote>
<p>å‰ç½®æŠ€èƒ½ï¼šJava åŸºç¡€ï¼ŒADTï¼Œç³»ç»Ÿ F Ï‰</p>
</blockquote>
<h2 id="Î»-ç«‹æ–¹">Î» ç«‹æ–¹</h2>
<p>è¡¨è¾¾å¼éç±»å‹éƒ¨åˆ†å«åšé¡¹ï¼ˆTermï¼‰ï¼Œç±»å‹éƒ¨åˆ†å«åšç±»å‹ï¼ˆTypeï¼‰ï¼Œå…¶ä¸­ç±»å‹çš„ç±»å‹ä¸ºç§ç±»ï¼ˆKindï¼‰ä¹Ÿå†™ä½œ <code>*</code> è€Œç§ç±»çš„ç±»å‹å†™ä½œ <code>â–¡</code>ã€‚è¡¨è¾¾å¼ä¸­çš„å‡½æ•°ç»“æ„ä¸º <code>Î» x: A. (M: B)</code> ï¼Œå¦‚æœè®° <code>A</code> çš„ç±»å‹ä¸º <code>S1</code> ï¼Œ <code>B</code> çš„ç±»å‹ä¸º <code>S2</code> ï¼Œé‚£ä¹ˆå¯ä»¥å¾—åˆ°ä¸€ä¸ªå¯¹å­ <code>(S1, S2)</code> ã€‚</p>
<p>ç®€å•ç±»å‹ Î» æ¼”ç®—ä¸­é¡¹å’Œç±»å‹æ˜¯åˆ†ç¦»çš„ï¼Œå…¶ä¸­åªæœ‰é’ˆå¯¹é¡¹çš„å‡½æ•°ï¼Œå®ƒæ¥æ”¶ä¸€ä¸ªé¡¹è¿”å›å¦ä¸€ä¸ªé¡¹ï¼Œå…¶å¾—åˆ°çš„å¯¹å­æ˜¯ <code>(*, *)</code> ã€‚ç³»ç»Ÿ F å¯¹ç±»å‹ç³»ç»Ÿè¿›è¡Œäº†æ‰©å……ï¼Œåœ¨é¡¹ä¸­å¢åŠ äº†ä¸€ç§å‡½æ•°ï¼Œæ¥æ”¶ä¸€ä¸ªç±»å‹è¿”å›ä¸€ä¸ªé¡¹ï¼Œå…¶å¾—åˆ°çš„å¯¹å­æ˜¯ <code>(â–¡, *)</code> ã€‚è€Œç³»ç»Ÿ F Ï‰ è¿›ä¸€æ­¥å¢åŠ äº†æ¥æ”¶ç±»å‹è¿”å›ç±»å‹çš„å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯ <code>(â–¡, â–¡)</code> ã€‚é‚£ä¹ˆå¯ä»¥æƒ³è±¡åº”è¯¥è¿˜å­˜åœ¨ä¸€ç±»å‡½æ•°æ¥æ”¶ä¸€ä¸ªå€¼äº§ç”Ÿä¸€ä¸ªç±»å‹ï¼Œå…¶å¾—åˆ°çš„å¯¹å­åº”è¯¥æ˜¯ <code>(*, â–¡)</code> ã€‚</p>
<p>å¯¹äºæ‰€æœ‰ Î» æ¼”ç®—éƒ½å­˜åœ¨ <code>(*, *)</code> çš„å‡½æ•°ï¼Œè€Œå¦å¤–ä¸‰ç§ä¸åŒå‡½æ•°æ˜¯ä¸‰ç§é¢å¤–çš„ç‰¹æ€§ï¼Œå¯ä»¥è‡ªç”±ç»„åˆæ¥æ„é€ æ–°çš„ç±»å‹ç³»ç»Ÿï¼Œä¸€å…±èƒ½ç»„åˆå‡ºå…­ç§ä¸åŒçš„ç±»å‹ç³»ç»Ÿï¼š</p>
<pre><code>    Ï‰ ------ C
  / |      / |
2 ------ P2  |
|   _Ï‰ --|- _PÏ‰
| /      | /
â†’ ------ P</code></pre>
<p>å·¦ä¸‹è§’çš„ Î»â†’ å°±æ˜¯ç®€å•ç±»å‹ Î» æ¼”ç®—ï¼Œå’Œå®ƒç›¸è¿çš„ä¸‰æ¡è¾¹å¯¹åº”åœ¨å…¶åŸºç¡€ä¸Šåˆ†åˆ«æ·»åŠ äº†ä¸‰ç§ä¸åŒå‡½æ•°çš„ Î» æ¼”ç®—ã€‚ Î»2 å°±æ˜¯ç³»ç»Ÿ F ï¼ŒåŒ…å« <code>(â–¡, *)</code> å‡½æ•°ã€‚ Î»<u>Ï‰</u> å°±æ˜¯å»é™¤äº†ç³»ç»Ÿ F å¯¹åº”ç‰¹æ€§çš„ç³»ç»Ÿ F Ï‰ ï¼Œä¹Ÿå«ç³»ç»Ÿ F <u>Ï‰</u> ã€‚å³ä¸‹çš„ Î»P å°±æ˜¯åœ¨ç®€å•ç±»å‹ Î» ä¸­åŠ å…¥äº† <code>(*, â–¡)</code> çš„ Î» æ¼”ç®—ï¼Œè€Œè¿™æ ·çš„ç±»å‹ç³»ç»Ÿä¸­ç±»å‹ä¾èµ–å€¼æ‰€ä»¥ä¹Ÿå«ä¾èµ–ç±»å‹ç³»ç»Ÿï¼ˆDependent Type Systemï¼‰ï¼Œåœ¨ C++ ä¸­æ¨¡æ¿å¯ä»¥æœ‰å€¼å‚æ•°æ‰€ä»¥å®é™…ä¸Š C++ çš„ç±»å‹ç³»ç»Ÿä¸­åŒ…æ‹¬ä¾èµ–ç±»å‹ï¼ˆDependent Typeï¼‰ã€‚</p>
<p>è¿™ä¸ªç«‹æ–¹ä½“å°±è¢«ç§°ä¸º Î» ç«‹æ–¹ï¼ˆLambda Cubeï¼‰ã€‚</p>
<h2 id="æ„é€ æ¼”ç®—">æ„é€ æ¼”ç®—</h2>
<p>åœ¨ Î» ç«‹æ–¹çš„é¡¶ç«¯æ”¾ç€ Î»C ï¼Œä¹Ÿå«æ„é€ æ¼”ç®—ï¼ˆCalculus of Construction, CoCï¼‰ã€‚åœ¨æ„é€ æ¼”ç®—ä¸­ç±»å‹å¯ä»¥ä½œä¸ºå‡½æ•°çš„è¾“å…¥ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºå‡½æ•°çš„è¾“å‡ºï¼Œé‚£ä¹ˆå®é™…ä¸Šæˆ‘ä»¬å¯ä»¥æŠŠé¡¹å’Œå‡½æ•°ä½œä¸ºç›¸åŒçš„ä¸œè¥¿ <code>Fun</code> ï¼Œä¸å†åŠ ä»¥åŒºåˆ†ã€‚è¿™æ ·å››ç§ä¸åŒçš„å‡½æ•°ä¹Ÿå¯ä»¥ä¸åŠ ä»¥åŒºåˆ†æ”¾åœ¨ä¸€èµ·ï¼ŒåŒæ—¶åŠ å…¥ç±»åˆ«ï¼ˆSortï¼‰æ¥è¡¨è¾¾ç±»å‹å’Œç±»å‹çš„ç±»å‹ã€‚è€Œä¸”å› ä¸º <code>A â†’ B</code> ç­‰ä»·äº <code>âˆ€ _: A. B</code> ï¼Œé‚£ä¹ˆç³»ç»Ÿ F Ï‰ ä¸­çš„ <code>TForall</code> å’Œ <code>TArr</code> ä¹Ÿå¯ä»¥åˆå¹¶ä¸º <code>Pi</code> ã€‚è¿™æ · CoC çš„è¯­æ³•æ ‘è¡¨ç¤ºå¦‚ä¸‹ï¼š</p>
<pre><code class="language-java"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">Expr</span> </span>{
    <span class="hljs-function">Expr <span class="hljs-title">genUUID</span><span class="hljs-params">()</span></span>;
    <span class="hljs-function">Expr <span class="hljs-title">applyUUID</span><span class="hljs-params">(Val v)</span></span>;

    <span class="hljs-function">Expr <span class="hljs-title">reduce</span><span class="hljs-params">()</span></span>;
    <span class="hljs-function">Expr <span class="hljs-title">fullReduce</span><span class="hljs-params">()</span></span>;
    <span class="hljs-function">Expr <span class="hljs-title">apply</span><span class="hljs-params">(Val v, Expr e)</span></span>;

    <span class="hljs-function">Expr <span class="hljs-title">checkType</span><span class="hljs-params">(Env env)</span> <span class="hljs-keyword">throws</span> BadTypeException</span>;
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Sort</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Expr</span> </span>{
    <span class="hljs-keyword">int</span> x; <span class="hljs-comment">// 1 ä¸º * ï¼Œ 2 ä¸º â–¡</span>
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Val</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Expr</span> </span>{
    String x;
    UUID id;
    Expr t; <span class="hljs-comment">// ç±»å‹</span>
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Fun</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Expr</span> </span>{
    <span class="hljs-comment">// Î» x: T. e</span>
    <span class="hljs-comment">// (x: T) â‡’ e</span>
    Val x;
    Expr e;
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">App</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Expr</span> </span>{
    Expr f, x;
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Pi</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Expr</span> </span>{
    <span class="hljs-comment">// Ï€ x: T. e</span>
    <span class="hljs-comment">// (x: T) â†’ e</span>
    Val x;
    Expr e;
}</code></pre>
<p>å…¶ä¸­ <code>Expr</code> çš„æ¥å£çš„å‡½æ•°è¢«åˆ†æˆäº†ä¸‰ç»„ï¼Œç¬¬ä¸€ç»„æ˜¯é¢„ç”Ÿæˆ <code>id</code> åªéœ€è¦ç®€å•é€’å½’ç”Ÿæˆå°±å¯ä»¥ï¼Œä¹‹å‰ä¹Ÿå±•ç¤ºè¿‡ï¼›ç¬¬äºŒç»„æ˜¯å¯¹è¡¨è¾¾å¼çš„åŒ–ç®€ï¼Œåªéœ€æ³¨æ„ <code>App</code> åœ¨åŒ–ç®€æ—¶åªåº”ç”¨ <code>Fun</code> åº”è¯¥å¿½ç•¥ <code>Pi</code> ï¼Œå¹¶ä¸”é€’å½’åŒ–ç®€æ—¶åˆ«å¿˜äº†å˜é‡éƒ¨åˆ†çš„ç±»å‹ä¹Ÿæ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼›ç¬¬ä¸‰ç»„å°±æ˜¯ç±»å‹æ£€æŸ¥éƒ¨åˆ†äº†ï¼Œ <code>Fun</code> çš„ç±»å‹æ˜¯ <code>Pi</code> ï¼Œ <code>Pi</code> çš„ç±»å‹æ˜¯ <code>e</code> çš„ç±»å‹ï¼Œ <code>App</code> æŠŠè¡¨è¾¾å¼åº”ç”¨åˆ° <code>Pi</code> ä¸Šï¼š</p>
<pre><code class="language-java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Sort</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Expr</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">public</span> Expr <span class="hljs-title">checkType</span><span class="hljs-params">(Env env)</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Sort(x + <span class="hljs-number">1</span>);
    }
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Val</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Expr</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">public</span> Expr <span class="hljs-title">checkType</span><span class="hljs-params">(Env env)</span> <span class="hljs-keyword">throws</span> BadTypeException </span>{
        <span class="hljs-keyword">if</span> (t == <span class="hljs-keyword">null</span>) <span class="hljs-keyword">return</span> env.lookup(id);
        <span class="hljs-keyword">return</span> t;
    }
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Fun</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Expr</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">public</span> Expr <span class="hljs-title">checkType</span><span class="hljs-params">(Env env)</span> <span class="hljs-keyword">throws</span> BadTypeException </span>{
        Expr pi = <span class="hljs-keyword">new</span> Pi(x, e.checkType(<span class="hljs-keyword">new</span> ConsEnv(x, env)));
        <span class="hljs-keyword">if</span> (pi.checkType(env) <span class="hljs-keyword">instanceof</span> Sort)
            <span class="hljs-keyword">return</span> pi;
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> BadTypeException();
    }
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">App</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Expr</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">public</span> Expr <span class="hljs-title">checkType</span><span class="hljs-params">(Env env)</span> <span class="hljs-keyword">throws</span> BadTypeException </span>{
        Expr tf = f.checkType(env);
        <span class="hljs-keyword">if</span> (tf <span class="hljs-keyword">instanceof</span> Pi) {
            Pi pi = (Pi) tf;
            <span class="hljs-keyword">if</span> (x.checkType(env).fullReduce().equals(
                    pi.x.checkType(env).fullReduce()))
                <span class="hljs-keyword">return</span> pi.e.apply(pi.x, x);
        }
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> BadTypeException();
    }
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Pi</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Expr</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">public</span> Expr <span class="hljs-title">checkType</span><span class="hljs-params">(Env env)</span> <span class="hljs-keyword">throws</span> BadTypeException </span>{
        Expr ta = x.t.checkType(env); <span class="hljs-comment">// x.t çš„ç±»å‹</span>
        Expr tb = e.checkType(<span class="hljs-keyword">new</span> ConsEnv(x, env));
        <span class="hljs-keyword">if</span> (ta <span class="hljs-keyword">instanceof</span> Sort &amp;&amp; tb <span class="hljs-keyword">instanceof</span> Sort) {
            <span class="hljs-keyword">return</span> tb;
        }
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> BadTypeException();
    }
}</code></pre>
<p>æ‰€ä»¥å®é™…ä¸Š <code>Pi</code> å°±æ˜¯ä¸€ä¸ªç±»å‹æ£€æŸ¥æœŸçš„æ ‡è¯†ï¼Œå¹¶ä¸å‚ä¸æœ€ç»ˆå€¼çš„æ¼”ç®—ã€‚å› ä¸ºä¸åŒºåˆ†å€¼å’Œç±»å‹ï¼Œå…¶ä¸­ <code>Env</code> ä¿å­˜çš„å†…å®¹æ”¹ä¸º <code>Val</code> ï¼Œå¹¶ä¸” <code>lookup</code> æ”¹ä¸ºç”¨ <code>UUID</code> æ£€ç´¢ã€‚</p>
<p>è¿™æ ·å°±æ„é€ å‡ºäº†ä¸€ä¸ªç›¸å½“å¼ºå¤§çš„ç±»å‹ç³»ç»Ÿï¼Œå®ƒçš„ä¾èµ–ç±»å‹ï¼ˆDependent Typeï¼‰ç‰¹æ€§æ˜¯å¸¸è§ç±»å‹ç³»ç»Ÿé‡Œé¢æ‰€æ²¡æœ‰çš„ã€‚ä¹‹åå°†ä¼šä»‹ç»å¦‚ä½•åˆ©ç”¨è¿™ä¸ªå¼ºå¤§çš„ç±»å‹ç³»ç»Ÿè¡¨è¾¾å¤æ‚çš„ç±»å‹ï¼Œåšä¸€äº›å¸¸è§ç±»å‹ç³»ç»Ÿåšä¸åˆ°çš„äº‹æƒ…ã€‚</p>
</body>
</html>
