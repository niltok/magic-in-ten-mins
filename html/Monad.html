<html>
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=0">
<title>
ååˆ†é’Ÿé­”æ³•ç»ƒä¹ </title>
<style>
body { max-width: 650px; margin: auto; width: 90%; margin-top: 10%; margin-bottom: 10%; color: #0B0E26; background: #FAFAFC; line-height: 2em; }
body { font-family: -apple-system,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Microsoft YaHei,Source Han Sans SC,Noto Sans CJK SC,WenQuanYi Micro Hei,sans-serif; }
h1 { font-size: 2.5em; color: #EF96AB; line-height: 1.5em; }
h2 { margin-top: 2em; line-height: 1.5em; }
blockquote { color: gray; margin: 0; padding: 1 1 1 20; border-left: 5px solid #EF96AB; }
code, pre { font-family: Consolas,Menlo,Monaco,source-code-pro,Courier New,monospace; background: #FCF6FC; }
pre { overflow-x: auto; padding: 10px; }
a { color: #02AEF1; text-decoration: none; }
@media (prefers-color-scheme: dark) { body { color: #D8D8D6; background: #0E0E10; } }
@media (prefers-color-scheme: dark) { pre, code { color: #D8D8D6; background: #0E0F1F; } }
.hljs-keyword { color: #F288AF; }
.hljs-comment { color: #929CA6; }
.hljs-string { color: #0594A6; }
.hljs-title { color: #4581D9 }
</style>
</head>
<body>
<p>
<a href="https://magic.huohuo.moe">ğŸ HomepageğŸ </a> | <a href="https://github.com/goldimax/magic-in-ten-mins">â­Star me on GitHubâ­</a></p>
<h1 id="ååˆ†é’Ÿé­”æ³•ç»ƒä¹ ï¼šå•å­">ååˆ†é’Ÿé­”æ³•ç»ƒä¹ ï¼šå•å­</h1>
<h3 id="by-ã€Œç©ç«ã€">By ã€Œç©ç«ã€</h3>
<blockquote>
<p>å‰ç½®æŠ€èƒ½ï¼šJavaåŸºç¡€ï¼ŒHKT</p>
</blockquote>
<h2 id="å•å­">å•å­</h2>
<p>å•å­(Monad)æ˜¯æŒ‡ä¸€ç§æœ‰ä¸€ä¸ªç±»å‹å‚æ•°çš„æ•°æ®ç»“æ„ï¼Œæ‹¥æœ‰ <code>pure</code> ï¼ˆä¹Ÿå« <code>unit</code> æˆ–è€… <code>return</code> ï¼‰å’Œ <code>flatMap</code> ï¼ˆä¹Ÿå« <code>bind</code> æˆ–è€… <code>&gt;&gt;=</code> ï¼‰ä¸¤ç§æ“ä½œï¼š</p>
<pre><code class="language-java"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">Monad</span>&lt;<span class="hljs-title">M</span>&gt; </span>{
    &lt;A&gt; <span class="hljs-function">HKT&lt;M, A&gt; <span class="hljs-title">pure</span><span class="hljs-params">(A v)</span></span>;

    &lt;A, B&gt; <span class="hljs-function">HKT&lt;M, B&gt;
    <span class="hljs-title">flatMap</span><span class="hljs-params">(HKT&lt;M, A&gt; ma, 
            Function&lt;A, HKT&lt;M, B&gt;&gt; f)</span></span>;
}</code></pre>
<p>å…¶ä¸­ <code>pure</code> è¦æ±‚è¿”å›ä¸€ä¸ªåŒ…å«å‚æ•°ç±»å‹å†…å®¹çš„æ•°æ®ç»“æ„ï¼Œ <code>flatMap</code> è¦æ±‚æŠŠ <code>ma</code> ä¸­çš„å€¼ç»è¿‡ <code>f</code> ä»¥åå†ä¸²èµ·æ¥ã€‚</p>
<p>ä¸¾ä¸ªæœ€ç»å…¸çš„ä¾‹å­ï¼š</p>
<h2 id="list-monad">List Monad</h2>
<pre><code class="language-java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HKTListM</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Monad</span>&lt;<span class="hljs-title">HKTList</span>&lt;?&gt;&gt; </span>{
    <span class="hljs-keyword">public</span> &lt;A&gt; HKT&lt;HKTList&lt;?&gt;, A&gt; pure(A v) {
        ArrayList&lt;A&gt; list = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();
        list.add(v);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> HKTList&lt;&gt;(list);
    }

    <span class="hljs-keyword">public</span> &lt;A, B&gt; HKT&lt;HKTList&lt;?&gt;, B&gt; 
    flatMap(HKT&lt;HKTList&lt;?&gt;, A&gt; ma, 
           Function&lt;A, HKT&lt;HKTList&lt;?&gt;, B&gt;&gt; f) {
        <span class="hljs-keyword">return</span> HKTList.narrow(ma).value
            .stream().flatMap(v -&gt; 
                HKTList.narrow(f.apply(v))
                    .value.stream())
            .collect(HKTList.collector());
    }
}</code></pre>
<p>ç®€å•æ¥è¯´ <code>pure(v)</code> å°†å¾—åˆ° <code>{v}</code> ï¼Œè€Œ <code>flatMap({1, 2, 3}, v -&gt; {v + 1, v + 2})</code> å°†å¾—åˆ° <code>{2, 3, 3, 4, 4, 5}</code> ã€‚è¿™éƒ½æ˜¯ Java é‡Œé¢éå¸¸å¸¸è§çš„æ“ä½œäº†ï¼Œå¹¶æ²¡æœ‰ä»€ä¹ˆæ–°æ„ã€‚</p>
<h2 id="maybe-monad">Maybe Monad</h2>
<p>Java ä¸æ˜¯ä¸€ä¸ªç©ºå®‰å…¨çš„è¯­è¨€ï¼Œä¹Ÿå°±æ˜¯è¯´ä»»ä½•å¯¹è±¡ç±»å‹çš„å˜é‡éƒ½æœ‰å¯èƒ½ä¸º <code>null</code> ã€‚å¯¹äºä¸€ä¸²å¯èƒ½å‡ºç°ç©ºå€¼çš„é€»è¾‘æ¥è¯´ï¼Œåˆ¤ç©ºå¸¸å¸¸æ˜¯ä»¶éº»çƒ¦äº‹ï¼š</p>
<pre><code class="language-java"><span class="hljs-function"><span class="hljs-keyword">static</span> Maybe&lt;Integer&gt;
<span class="hljs-title">addI</span><span class="hljs-params">(Maybe&lt;Integer&gt; ma, Maybe&lt;Integer&gt; mb)</span> </span>{
    <span class="hljs-keyword">if</span> (ma.value == <span class="hljs-keyword">null</span>) <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Maybe&lt;&gt;();
    <span class="hljs-keyword">if</span> (mb.value == <span class="hljs-keyword">null</span>) <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Maybe&lt;&gt;();
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Maybe&lt;&gt;(ma.value + mb.value);
}</code></pre>
<p>å…¶ä¸­ <code>Maybe</code> æ˜¯ä¸ª <code>HKT</code> çš„åŒ…è£…ç±»å‹ï¼š</p>
<pre><code class="language-java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Maybe</span>&lt;<span class="hljs-title">A</span>&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title">HKT</span>&lt;<span class="hljs-title">Maybe</span>&lt;?&gt;, <span class="hljs-title">A</span>&gt; </span>{
    A value;
    Maybe() { value = <span class="hljs-keyword">null</span>; }
    Maybe(A v) { value = v; }
    <span class="hljs-keyword">static</span> &lt;T&gt; <span class="hljs-function">Maybe&lt;T&gt; 
    <span class="hljs-title">narrow</span><span class="hljs-params">(HKT&lt;Maybe&lt;?&gt;, T&gt; v)</span> </span>{
        <span class="hljs-keyword">return</span> (Maybe&lt;T&gt;) v;
    }
}</code></pre>
<p>åƒè¿™æ ·å®šä¹‰ <code>Maybe Monad</code> ï¼š</p>
<pre><code class="language-java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MaybeM</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Monad</span>&lt;<span class="hljs-title">Maybe</span>&lt;?&gt;&gt; </span>{
    <span class="hljs-keyword">public</span> &lt;A&gt; HKT&lt;Maybe&lt;?&gt;, A&gt; pure(A v) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Maybe&lt;&gt;(v);
    }
    <span class="hljs-keyword">public</span> &lt;A, B&gt; HKT&lt;Maybe&lt;?&gt;, B&gt;
    flatMap(HKT&lt;Maybe&lt;?&gt;, A&gt; ma, 
            Function&lt;A, HKT&lt;Maybe&lt;?&gt;, B&gt;&gt; f) {
        A v = Maybe.narrow(ma).value;
        <span class="hljs-keyword">if</span> (v == <span class="hljs-keyword">null</span>) <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Maybe&lt;&gt;();
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> f.apply(v);
    }
}</code></pre>
<p>ä¸Šé¢ <code>addI</code> çš„ä»£ç å°±å¯ä»¥æ”¹æˆï¼š</p>
<pre><code class="language-java"><span class="hljs-function"><span class="hljs-keyword">static</span> Maybe&lt;Integer&gt;
<span class="hljs-title">addM</span><span class="hljs-params">(Maybe&lt;Integer&gt; ma, Maybe&lt;Integer&gt; mb)</span> </span>{
    MaybeM m = <span class="hljs-keyword">new</span> MaybeM();
    <span class="hljs-keyword">return</span> Maybe.narrow(   <span class="hljs-comment">// do</span>
        m.flatMap(ma, a -&gt; <span class="hljs-comment">//   a &lt;- ma</span>
        m.flatMap(mb, b -&gt; <span class="hljs-comment">//   b &lt;- mb</span>
        m.pure(a + b)))    <span class="hljs-comment">//   pure (a + b)</span>
    );
}</code></pre>
<p>è¿™æ ·çœ‹ä¸Šå»å°±æ¯”ä¸Šé¢çš„è¿ç»­ <code>if-return</code> ä¼˜é›…å¾ˆå¤šã€‚åœ¨ä¸€äº›æœ‰è¯­æ³•ç³–çš„è¯­è¨€ (<code>Haskell</code>) é‡Œé¢ Monad çš„é€»è¾‘ç”šè‡³å¯ä»¥åƒä¸Šé¢å³è¾¹çš„æ³¨é‡Šä¸€æ ·ç®€å•æ˜äº†ã€‚</p>
<blockquote>
<p>æˆ‘çŸ¥é“ä¼šæœ‰äººè¯´ï¼Œå•Šï¼Œæˆ‘æœ‰æ›´ç®€å•çš„å†™æ³•ï¼š</p>
<pre><code class="language-java"><span class="hljs-function"><span class="hljs-keyword">static</span> Maybe&lt;Integer&gt;
<span class="hljs-title">addE</span><span class="hljs-params">(Maybe&lt;Integer&gt; ma, 
     Maybe&lt;Integer&gt; mb)</span> </span>{
    <span class="hljs-keyword">try</span> { <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Maybe&lt;&gt;(
            ma.value + mb.value);
    } <span class="hljs-keyword">catch</span> (Exception e) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Maybe&lt;&gt;();
    }
}</code></pre>
<p>ç¡®å®ï¼Œè¿™æ ·å†™ä¹ŸæŒºç®€æ´ç›´è§‚çš„ï¼Œ <code>Maybe Monad</code> åœ¨æœ‰å¼‚å¸¸çš„ Java é‡Œé¢ç¡®å®ä¸æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ï¼Œä¸è¿‡ <code>Maybe Monad</code> ç¡®å®æ˜¯åœ¨å…¶ä»–æ²¡æœ‰å¼‚å¸¸çš„å‡½æ•°å¼è¯­è¨€é‡Œé¢æœ€ä¸ºå¸¸è§çš„ Monad ç”¨æ³•ä¹‹ä¸€ã€‚è€Œä¹‹åæˆ‘ä¹Ÿä¼šä»‹ç»ä¸€äº›å¼‚å¸¸ä¹Ÿæ— èƒ½ä¸ºåŠ›çš„ Monad ç”¨æ³•ã€‚</p>
</blockquote>
</body>
</html>
