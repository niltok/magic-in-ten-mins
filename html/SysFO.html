<html>
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=0">
<title>
ååˆ†é’Ÿé­”æ³•ç»ƒä¹ </title>
<style>
body { max-width: 650px; margin: auto; width: 90%; margin-top: 10%; margin-bottom: 10%; color: #0B0E26; background: #FAFAFC; line-height: 2em; font-variant-ligatures: common-ligatures discretionary-ligatures; -webkit-font-feature-settings: "liga" on, "calt" on; font-feature-settings: "liga" on, "calt" on; }
body { font-size: 20px; font-family: -apple-system,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Microsoft YaHei,Source Han Sans SC,Noto Sans CJK SC,WenQuanYi Micro Hei,sans-serif; }
h1 { font-size: 2.5em; color: #EF96AB; line-height: 1.5em; }
h2 { margin-top: 2em; line-height: 1.5em; }
blockquote { color: gray; margin: 0; padding: 1 1 1 20; border-left: 5px solid #EF96AB; }
code, pre { font-size: 0.9em; line-height: 1.8em; font-family: "JetBrains Mono","ç­‰è·æ›´çº±é»‘ä½“ SC","Fira Code",Menlo,Monaco,source-code-pro,Courier New,Consolas,monospace; background: #FCF6FC; border-radius: 3px; padding-inline: 0.3rem; }
pre { overflow-x: auto; padding: 1rem; }
pre>code { padding-inline: 0; }
a { color: #02AEF1; text-decoration: none; }
@media (prefers-color-scheme: dark) { body { color: #D8D8D6; background: #0E0E10; } }
@media (prefers-color-scheme: dark) { pre, code { color: #D8D8D6; background: #0E0F1F; } }
.hljs-keyword { color: #F288AF; }
.hljs-comment { color: #929CA6; }
.hljs-string { color: #0594A6; }
.hljs-title { color: #4581D9; }
.hljs-type, .hljs-built_in { color: #fca311; }
</style>
</head>
<body>
<p>
<a href="https://magic.huohuo.moe">ğŸ HomepageğŸ </a> | <a href="https://github.com/niltok/magic-in-ten-mins">â­Star me on GitHubâ­</a></p>
<h1 id="ååˆ†é’Ÿé­”æ³•ç»ƒä¹ ï¼šç³»ç»Ÿ-f-Ï‰">ååˆ†é’Ÿé­”æ³•ç»ƒä¹ ï¼šç³»ç»Ÿ F Ï‰</h1>
<h3 id="by-ã€Œç©ç«ã€">By ã€Œç©ç«ã€</h3>
<blockquote>
<p>å‰ç½®æŠ€èƒ½ï¼šJava åŸºç¡€ï¼ŒADTï¼Œç³»ç»Ÿ F</p>
</blockquote>
<p>åœ¨ Java å’Œ C# ä¸­æœ‰æ³›å‹ï¼Œåœ¨ C++ ä¸­æœ‰æ¨¡æ¿ï¼Œä»–ä»¬éƒ½å¯ä»¥è®©ä¸€ä¸ªç±»å‹æ¥å—ä¸€äº›ç±»å‹äº§ç”Ÿä¸€ä¸ªç±»å‹ï¼Œæ¯”å¦‚ï¼š</p>
<pre><code class="language-java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Just</span>&lt;<span class="hljs-title">T</span>&gt; </span>{
    T value;
}
</code></pre>
<p><code>Just</code> å°±æ˜¯ä¸ªèƒ½æ¥å—ç±»å‹å‚æ•° <code>T</code> çš„ç±»å‹ï¼Œå®ƒè¢«ç§°ä¸ºç±»å‹æ„é€ å™¨ï¼ˆType Constructorï¼‰ã€‚åœ¨ç³»ç»Ÿ F ä¸­åŠ å…¥ç±»å‹æ„é€ å™¨åå®ƒè¢«ç§°ä¸ºç³»ç»Ÿ F Ï‰ ï¼ˆSystem F Ï‰ï¼‰ã€‚åŠ å…¥äº†ç±»å‹æ„é€ å™¨åå°±å¯ä»¥åœ¨ Î» æ¼”ç®—ä¸­æ„é€ æ³›å‹å®¹å™¨äº†ï¼Œæ¯”å¦‚æ„é€ æ³›å‹çš„ List ã€‚</p>
<p>å®é™…ä¸Šè¿™ç›¸å½“äºåœ¨ç±»å‹ç³»ç»Ÿä¸­åµŒå…¥äº†ä¸€ä¸ªå®Œæ•´çš„ Î» æ¼”ç®—è§£é‡Šå™¨ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨ç³»ç»Ÿ F çš„ç±»å‹ç³»ç»Ÿä¸­åŠ å…¥ <code>TFun</code> æ¥å®šä¹‰ä¸€ä¸ªç±»å‹å‡½æ•° <code>TApp</code> æ¥åº”ç”¨ä¸€ä¸ªç±»å‹å‡½æ•°ï¼š</p>
<pre><code class="language-java"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">Type</span> </span>{
    <span class="hljs-function">Type <span class="hljs-title">reduce</span><span class="hljs-params">()</span></span>;
    <span class="hljs-function">Type <span class="hljs-title">fullReduce</span><span class="hljs-params">()</span></span>;
    <span class="hljs-function">Type <span class="hljs-title">apply</span><span class="hljs-params">(TVal v, Type t)</span></span>;
    <span class="hljs-function">Type <span class="hljs-title">genUUID</span><span class="hljs-params">()</span></span>;
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TVal</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Type</span> </span>{
    String x;
    UUID id;
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TFun</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Type</span> </span>{
    TVal x;
    Type t;
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TApp</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Type</span> </span>{
    Type f, x;
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TForall</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Type</span> </span>{
    TVal x;
    Type t;
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TArr</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Type</span> </span>{
    Type a, b;
    <span class="hljs-function"><span class="hljs-keyword">public</span> Type <span class="hljs-title">reduce</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> TArr(a.reduce(), b.reduce());
    }
    <span class="hljs-function"><span class="hljs-keyword">public</span> Type <span class="hljs-title">fullReduce</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> TArr(a.fullReduce(), b.fullReduce());
    }
    <span class="hljs-function"><span class="hljs-keyword">public</span> Type <span class="hljs-title">apply</span><span class="hljs-params">(TVal v, Type t)</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> TArr(a.apply(v, t), b.apply(v, t));
    }
}
</code></pre>
<p>å…¶ä¸­ <code>TVal</code> ã€ <code>TFun</code> å’Œ <code>TApp</code> çš„å‡½æ•°å®ç°å’Œæ— ç±»å‹ Î» æ¼”ç®—ä¸­çš„è¡¨è¾¾å¼åŸºæœ¬ä¸€è‡´ï¼Œä¸è¿‡æ³¨æ„è¦åŠ ä¸Š <code>equals</code> å‡½æ•°çš„å®ç°ï¼Œå¹¶ä¸” <code>TFun</code> åœ¨æ¯”è¾ƒå‰éœ€è¦æŠŠå˜é‡æ›¿æ¢æˆä¸€æ ·çš„ï¼Œ <code>fullReduce</code> å‡½æ•°åœ¨ Y ç»„åˆå­é‚£æœŸä¸­ç»™å‡ºäº†å®ç°ï¼Œè¿™é‡Œå°±ä¸è´´å‡ºå±•ç¤ºäº†ã€‚è€Œ <code>TForall</code> çš„å®ç°å¯ä»¥å‚è€ƒ System F ï¼Œ <code>TArr</code> çš„å®ç°ä¹Ÿåªæ˜¯ç®€å•è¿›è¡Œé€’å½’è°ƒç”¨ï¼Œéå¸¸ç®€å•ã€‚</p>
<p>è€Œè¡¨è¾¾å¼ç›¸æ¯”ç³»ç»Ÿ F éœ€è¦çš„æ”¹åŠ¨æ˜¯ <code>TVal</code> åœ¨æ£€æŸ¥ç±»å‹æ—¶éœ€è¦å…ˆè°ƒç”¨ <code>fullReduce</code> æ¥åŒ–ç®€ç±»å‹ï¼š</p>
<pre><code class="language-java"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">Expr</span> </span>{
    <span class="hljs-function">Type <span class="hljs-title">checkType</span><span class="hljs-params">(Env env)</span> <span class="hljs-keyword">throws</span> BadTypeException</span>;
    <span class="hljs-function">Expr <span class="hljs-title">genUUID</span><span class="hljs-params">()</span></span>;
    <span class="hljs-function">Expr <span class="hljs-title">applyUUID</span><span class="hljs-params">(TVal v)</span></span>;
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Val</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Expr</span> </span>{
    String x;
    Type t;
    <span class="hljs-function"><span class="hljs-keyword">public</span> Type <span class="hljs-title">checkType</span><span class="hljs-params">(Env env)</span> </span>{
        <span class="hljs-keyword">if</span> (t == <span class="hljs-keyword">null</span>) <span class="hljs-keyword">return</span> env.lookup(x);
        <span class="hljs-keyword">return</span> t;
    }
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Fun</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Expr</span> </span>{
    Val x;
    Expr e;
    <span class="hljs-function"><span class="hljs-keyword">public</span> Type <span class="hljs-title">checkType</span><span class="hljs-params">(Env env)</span> <span class="hljs-keyword">throws</span> BadTypeException </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> TArr(x.t, e.checkType(<span class="hljs-keyword">new</span> ConsEnv(x, env)));
    }
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">App</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Expr</span> </span>{
    Expr f, x;
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Forall</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Expr</span> </span>{
    TVal x;
    Expr e;
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AppT</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Expr</span> </span>{
    Expr e;
    Type t;
}
</code></pre>
<p>æœ‰äº†ç±»å‹æ„é€ å™¨ï¼Œæˆ‘ä»¬å°±å¯ä»¥è¡¨è¾¾å¸¦æœ‰æ³›å‹çš„å®¹å™¨ï¼Œæ¯”å¦‚åˆ—è¡¨ï¼ˆå»ºè®®åªçœ‹æ³¨é‡Šï¼‰ï¼š</p>
<pre><code class="language-java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">TypeCons</span> </span>{
    <span class="hljs-comment">// List = Î» X. âˆ€ R. (X â†’ (R â†’ R)) â†’ (R â†’ R)</span>
    Type List = <span class="hljs-keyword">new</span> TFun(<span class="hljs-string">&quot;X&quot;</span>, <span class="hljs-keyword">new</span> TForall(<span class="hljs-string">&quot;R&quot;</span>, <span class="hljs-keyword">new</span> TArr(
        <span class="hljs-keyword">new</span> TArr(<span class="hljs-keyword">new</span> TVal(<span class="hljs-string">&quot;X&quot;</span>), <span class="hljs-keyword">new</span> TArr(<span class="hljs-keyword">new</span> TVal(<span class="hljs-string">&quot;R&quot;</span>), <span class="hljs-keyword">new</span> TVal(<span class="hljs-string">&quot;R&quot;</span>))),
        <span class="hljs-keyword">new</span> TArr(<span class="hljs-keyword">new</span> TVal(<span class="hljs-string">&quot;R&quot;</span>), <span class="hljs-keyword">new</span> TVal(<span class="hljs-string">&quot;R&quot;</span>))))).genUUID();
    <span class="hljs-comment">// nil  = Î› X. (Î› R. Î» c: X â†’ (R â†’ R). Î» n: R. n)</span>
    Expr nil = <span class="hljs-keyword">new</span> Forall(<span class="hljs-string">&quot;X&quot;</span>, <span class="hljs-keyword">new</span> Forall(<span class="hljs-string">&quot;R&quot;</span>, <span class="hljs-keyword">new</span> Fun(
        <span class="hljs-keyword">new</span> Val(<span class="hljs-string">&quot;c&quot;</span>, <span class="hljs-keyword">new</span> TArr(<span class="hljs-keyword">new</span> TVal(<span class="hljs-string">&quot;X&quot;</span>), <span class="hljs-keyword">new</span> TArr(<span class="hljs-keyword">new</span> TVal(<span class="hljs-string">&quot;R&quot;</span>), <span class="hljs-keyword">new</span> TVal(<span class="hljs-string">&quot;R&quot;</span>)))),
        <span class="hljs-keyword">new</span> Fun(<span class="hljs-keyword">new</span> Val(<span class="hljs-string">&quot;n&quot;</span> , <span class="hljs-keyword">new</span> TVal(<span class="hljs-string">&quot;R&quot;</span>)), <span class="hljs-keyword">new</span> Val(<span class="hljs-string">&quot;n&quot;</span>))))).genUUID();
    <span class="hljs-comment">// cons = Î› X. Î» h: X. Î» t: List X. (Î› R. Î» c: X â†’ R â†’ R. Î» n: R. c h (t R c n))</span>
    Expr cons = <span class="hljs-keyword">new</span> Forall(<span class="hljs-string">&quot;X&quot;</span>, <span class="hljs-keyword">new</span> Fun(<span class="hljs-keyword">new</span> Val(<span class="hljs-string">&quot;h&quot;</span>, <span class="hljs-keyword">new</span> TVal(<span class="hljs-string">&quot;X&quot;</span>)), <span class="hljs-keyword">new</span> Fun(
        <span class="hljs-keyword">new</span> Val(<span class="hljs-string">&quot;t&quot;</span>, <span class="hljs-keyword">new</span> TApp(List, <span class="hljs-keyword">new</span> TVal(<span class="hljs-string">&quot;X&quot;</span>))),
        <span class="hljs-keyword">new</span> Forall(<span class="hljs-string">&quot;R&quot;</span>, <span class="hljs-keyword">new</span> Fun(
            <span class="hljs-keyword">new</span> Val(<span class="hljs-string">&quot;c&quot;</span>, <span class="hljs-keyword">new</span> TArr(<span class="hljs-keyword">new</span> TVal(<span class="hljs-string">&quot;X&quot;</span>), <span class="hljs-keyword">new</span> TArr(<span class="hljs-keyword">new</span> TVal(<span class="hljs-string">&quot;R&quot;</span>), <span class="hljs-keyword">new</span> TVal(<span class="hljs-string">&quot;R&quot;</span>)))),
            <span class="hljs-keyword">new</span> Fun(<span class="hljs-keyword">new</span> Val(<span class="hljs-string">&quot;n&quot;</span>, <span class="hljs-keyword">new</span> TVal(<span class="hljs-string">&quot;R&quot;</span>)), <span class="hljs-keyword">new</span> App(
                <span class="hljs-keyword">new</span> App(<span class="hljs-keyword">new</span> Val(<span class="hljs-string">&quot;c&quot;</span>), <span class="hljs-keyword">new</span> Val(<span class="hljs-string">&quot;h&quot;</span>)),
                <span class="hljs-keyword">new</span> App(<span class="hljs-keyword">new</span> App(<span class="hljs-keyword">new</span> AppT(<span class="hljs-keyword">new</span> Val(<span class="hljs-string">&quot;t&quot;</span>), <span class="hljs-keyword">new</span> TVal(<span class="hljs-string">&quot;R&quot;</span>)),
                    <span class="hljs-keyword">new</span> Val(<span class="hljs-string">&quot;c&quot;</span>)), <span class="hljs-keyword">new</span> Val(<span class="hljs-string">&quot;n&quot;</span>))))))))).genUUID();
    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> BadTypeException </span>{
        <span class="hljs-comment">// (âˆ€ X. (âˆ€ R. ((X â†’ (R â†’ R)) â†’ (R â†’ R))))</span>
        System.out.println(nil.checkType());
        <span class="hljs-comment">// (âˆ€ X. (X â†’ ((âˆ€ R. ((X â†’ (R â†’ R)) â†’ (R â†’ R))) â†’ (âˆ€ R. ((X â†’ (R â†’ R)) â†’ (R â†’ R))))))</span>
        System.out.println(cons.checkType());
    }
}
</code></pre>
<p>è¿™ä¸ªåˆ—è¡¨çš„æ„é€ ç±»ä¼¼äºè‡ªç„¶æ•°ï¼Œæ¯æ¬¡åœ¨åŸåˆ—è¡¨çš„å¤–é¢å¥—ä¸€å±‚æ¥å¢åŠ ä¸€é¡¹ã€‚</p>
<p>æ³¨æ„ä¸Šé¢çš„ç±»å‹ç³»ç»Ÿä¸­æ˜¯ä¸ªæ— ç±»å‹çš„ Î» æ¼”ç®—ï¼Œå®é™…ä¸Šç±»å‹ä¹Ÿæ˜¯å¯ä»¥æ‹¥æœ‰ç±»å‹çš„ï¼Œè¢«ç§°ä¸ºç§ç±»ï¼ˆKindï¼‰ã€‚åŸºç¡€ç±»å‹å’Œå‡½æ•°ç±»å‹çš„ç§ç±»æ˜¯ <code>*</code> ï¼Œè€Œç±»å‹æ„é€ å™¨çš„ç§ç±»æ˜¯ <code>* â†’ *</code> ã€‚è€Œä¸ºäº†å¢å¼ºç±»å‹æ£€æŸ¥å™¨çš„èƒ½åŠ›æˆ‘ä»¬ä¹Ÿå¯ä»¥å…ˆè¿›è¡Œç§ç±»æ£€æŸ¥ï¼Œä¸è¿‡è¿™é‡Œå¹¶æ²¡å®ç°ã€‚</p>
</body>
</html>
